<!DOCTYPE html><html class="theme-next gemini" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link rel="stylesheet" href="/lib/pace/pace-theme-flash.min.css?v=1.0.2"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"><link rel="stylesheet" href="/css/main.css?v=6.7.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/next-favicon-32.png?v=6.7.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/next-favicon-16.png?v=6.7.0"><link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"6.7.0",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!1,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="目的zabbix是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。因其监控方式多样，上手容易在互联网行业备受欢迎。那么本文就详细介绍编译安装zabbix长期支持版本(LST)."><meta name="keywords" content="Zabbix"><meta property="og:type" content="article"><meta property="og:title" content="zabbix3.0.x在lnmp全编译安装"><meta property="og:url" content="http://wandouduoduo.github.io/articles/3131633d.html"><meta property="og:site_name" content="豌豆多多"><meta property="og:description" content="目的zabbix是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。因其监控方式多样，上手容易在互联网行业备受欢迎。那么本文就详细介绍编译安装zabbix长期支持版本(LST)."><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://wandouduoduo.github.io/articles/3131633d/1.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/3131633d/2.png"><meta property="og:updated_time" content="2019-08-07T02:06:43.862Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="zabbix3.0.x在lnmp全编译安装"><meta name="twitter:description" content="目的zabbix是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。因其监控方式多样，上手容易在互联网行业备受欢迎。那么本文就详细介绍编译安装zabbix长期支持版本(LST)."><meta name="twitter:image" content="http://wandouduoduo.github.io/articles/3131633d/1.png"><link rel="alternate" href="/atom.xml" title="豌豆多多" type="application/atom+xml"><link rel="canonical" href="http://wandouduoduo.github.io/articles/3131633d.html"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>zabbix3.0.x在lnmp全编译安装 | 豌豆多多</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/wandouduoduo" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">豌豆多多</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Deveops Study Notes</p></div><div class="site-nav-toggle"> <button aria-label="切换导航栏"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-guide"><a href="/guide/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>指南</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://wandouduoduo.github.io/articles/3131633d.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="WanDouDuoDuo"><meta itemprop="description" content><meta itemprop="image" content="/images/me.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="豌豆多多"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">zabbix3.0.x在lnmp全编译安装</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-06-17 09:39:40" itemprop="dateCreated datePublished" datetime="2019-06-17T09:39:40+08:00">2019-06-17</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2019-08-07 10:06:43" itemprop="dateModified" datetime="2019-08-07T10:06:43+08:00">2019-08-07</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/应用运维/" itemprop="url" rel="index"><span itemprop="name">应用运维</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/应用运维/服务搭建/" itemprop="url" rel="index"><span itemprop="name">服务搭建</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i> 阅读次数：<span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span title="本文字数">43k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">39 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>zabbix是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。因其监控方式多样，上手容易在互联网行业备受欢迎。那么本文就详细介绍编译安装zabbix长期支持版本(LST).</p><a id="more"></a><h2 id="环境版本："><a href="#环境版本：" class="headerlink" title="环境版本："></a>环境版本：</h2><h4 id="lnmp系统："><a href="#lnmp系统：" class="headerlink" title="lnmp系统："></a>lnmp系统：</h4><p>​ ubuntu 14.04</p><p>​ nginx 1.10.1</p><p>​ mysql 5.7.13</p><p>​ php 5.6.23</p><h4 id="监控系统："><a href="#监控系统：" class="headerlink" title="监控系统："></a>监控系统：</h4><p>​ zabbix 3.0.3</p><p>​ zatree 3.0.x</p><p>​ grafana 3.1.0</p><h4 id="安装路径："><a href="#安装路径：" class="headerlink" title="安装路径："></a>安装路径：</h4><p>程序安装路径：/opt/zabbix</p><p>数据路径：/data/zabbix</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="安装nginx-php"><a href="#安装nginx-php" class="headerlink" title="安装nginx + php"></a>安装nginx + php</h3><h4 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -y install make gcc g++ libpcre3-dev libssl-dev libpng-dev libxml2-dev libcurl4-openssl-dev</span><br></pre></td></tr></table></figure><h4 id="编译安装nginx"><a href="#编译安装nginx" class="headerlink" title="编译安装nginx"></a>编译安装nginx</h4><p>创建运行账户及组</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd www</span><br><span class="line">sudo useradd www -s /sbin/nologin -g www</span><br></pre></td></tr></table></figure><p>开始编译nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">sudo wget http://nginx.org/download/nginx-1.10.1.tar.gz</span><br><span class="line">sudo tar zxvf nginx-1.10.1.tar.gz </span><br><span class="line">cd nginx-1.10.1/</span><br><span class="line">sudo ./configure --user=www --group=www --prefix=/opt/nginx --with-http_stub_status_module --with-http_ssl_module</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br><span class="line">cd /opt</span><br><span class="line">sudo chown -R www.www nginx</span><br></pre></td></tr></table></figure><p>创建nginx启动脚本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/init.d/nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh  </span></span><br><span class="line">  </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## BEGIN INIT INFO  </span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Provides:     nginx  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Required-Start:  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Required-Stop:  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default-Start:        2 3 4 5  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default-Stop:         0 1 6  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Short-Description: nginx  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Description: nginx server  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## END INIT INFO  </span></span></span><br><span class="line">  </span><br><span class="line">. /lib/lsb/init-functions  </span><br><span class="line">  </span><br><span class="line">PROGRAM=/opt/nginx/sbin/nginx  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">test -x $PROGRAM || exit 0  </span><br><span class="line">  </span><br><span class="line">case "$1" in  </span><br><span class="line">  start)  </span><br><span class="line">     log_begin_msg "Starting Nginx server"  </span><br><span class="line">     /opt/nginx/sbin/nginx  </span><br><span class="line">     log_end_msg 0  </span><br><span class="line">          ;;  </span><br><span class="line">  stop)  </span><br><span class="line">     PID=`cat /opt/nginx/logs/nginx.pid`  </span><br><span class="line">     log_begin_msg "Stopping Nginx server"  </span><br><span class="line">     if [ ! -z "$PID" ]; then  </span><br><span class="line">        kill -15 $PID  </span><br><span class="line">     fi  </span><br><span class="line">     log_end_msg 0  </span><br><span class="line">     ;;  </span><br><span class="line">  restart)  </span><br><span class="line">     $0 stop  </span><br><span class="line">     $0 start  </span><br><span class="line">     ;;  </span><br><span class="line">  *)  </span><br><span class="line">     log_success_msg "Usage: service nginx &#123;start|stop|restart&#125;"  </span><br><span class="line">     exit 1  </span><br><span class="line">esac  </span><br><span class="line">  </span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure><p>添加启动权限并启动nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /etc/init.d/nginx</span><br><span class="line">sudo /etc/init.d/nginx start</span><br><span class="line">sudo update-rc.d nginx defaults</span><br></pre></td></tr></table></figure><p>验证是否安装成功。在浏览器地址栏输入ip,出现下图为ok.</p><p><img src="/articles/3131633d/1.png" alt="img"></p><h3 id="安装php"><a href="#安装php" class="headerlink" title="安装php"></a>安装php</h3><h4 id="安装bzip2"><a href="#安装bzip2" class="headerlink" title="安装bzip2"></a>安装bzip2</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">sudo wget http://www.bzip.org/1.0.6/bzip2-1.0.6.tar.gz</span><br><span class="line">sudo tar zxvf bzip2-1.0.6.tar.gz</span><br><span class="line">cd bzip2-1.0.6/</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##64位系统需要修改Makefile文件后再make，修改内容如下</span></span></span><br><span class="line">CC=gcc -fPIC</span><br><span class="line">sudo make</span><br><span class="line">sudo make install PREFIX=/opt/bzip2</span><br></pre></td></tr></table></figure><h4 id="安装zlib"><a href="#安装zlib" class="headerlink" title="安装zlib"></a>安装zlib</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">sudo wget http://heanet.dl.sourceforge.net/project/libpng/zlib/1.2.8/zlib-1.2.8.tar.gz</span><br><span class="line">sudo tar zxvf zlib-1.2.8.tar.gz</span><br><span class="line">cd zlib-1.2.8/</span><br><span class="line">sudo ./configure --prefix=/opt/zlib</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><h4 id="安装libmcrypt"><a href="#安装libmcrypt" class="headerlink" title="安装libmcrypt"></a>安装libmcrypt</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">sudo wget http://jaist.dl.sourceforge.net/project/mcrypt/Libmcrypt/2.5.8/libmcrypt-2.5.8.tar.gz</span><br><span class="line">sudo tar zxvf libmcrypt-2.5.8.tar.gz</span><br><span class="line">cd libmcrypt-2.5.8/</span><br><span class="line">sudo ./configure --prefix=/opt/libmcrypt</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><h4 id="安装freetype"><a href="#安装freetype" class="headerlink" title="安装freetype"></a>安装freetype</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">sudo wget http://ftp.yzu.edu.tw/nongnu//freetype/freetype-2.6.tar.gz</span><br><span class="line">sudo tar zxvf freetype-2.6.tar.gz </span><br><span class="line">cd freetype-2.6/</span><br><span class="line">sudo ./configure --prefix=/opt/freetype</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><h4 id="安装jpegsrc（zabbix需要）"><a href="#安装jpegsrc（zabbix需要）" class="headerlink" title="安装jpegsrc（zabbix需要）"></a>安装jpegsrc（zabbix需要）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">sudo wget http://www.ijg.org/files/jpegsrc.v9b.tar.gz </span><br><span class="line">sudo tar zxvf jpegsrc.v9b.tar.gz</span><br><span class="line">cd jpeg-9b/</span><br><span class="line">sudo ./configure --prefix=/opt/jpeg</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><h4 id="编译安装php"><a href="#编译安装php" class="headerlink" title="编译安装php"></a>编译安装php</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">sudo wget http://ar2.php.net/distributions/php-5.6.23.tar.gz</span><br><span class="line">sudo tar zxvf php-5.6.23.tar.gz </span><br><span class="line">cd php-5.6.23/</span><br><span class="line">sudo  ./configure --prefix=/opt/php --with-config-file-path=/opt/php/etc --enable-fpm --with-mcrypt=/opt/libmcrypt --with-zlib=/opt/zlib --with-openssl --with-mysql --with-mysql-sock --with-gd --enable-xml --with-bz2=/usr/local/lib --enable-zip --with-freetype-dir=/opt/freetype --with-mysqli --enable-mysqlnd  --with-curl --enable-mbstring --enable-bcmath --enable-sockets --with-jpeg-dir=/opt/jpeg --with-gd --with-gettext</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br><span class="line">cd /opt</span><br><span class="line">sudo chown -R www.www php</span><br></pre></td></tr></table></figure><h3 id="整合nginx-php"><a href="#整合nginx-php" class="headerlink" title="整合nginx + php"></a>整合nginx + php</h3><h4 id="创建php、php-fpm配置文件"><a href="#创建php、php-fpm配置文件" class="headerlink" title="创建php、php-fpm配置文件"></a>创建php、php-fpm配置文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /opt/php-5.6.23/php.ini-production /opt/php/etc/php.ini</span><br><span class="line">sudo vim /opt/php/etc/php.ini </span><br><span class="line">修改如下行</span><br><span class="line">    date.timezone = Asia/Shanghai</span><br><span class="line">sudo cp /opt/php/etc/php-fpm.conf.default /opt/php/etc/php-fpm.conf</span><br><span class="line">sudo vim /opt/php/etc/php-fpm.conf</span><br><span class="line">修改如下行</span><br><span class="line">user = www</span><br><span class="line">group = www</span><br><span class="line">pid = run/php-fpm.pid</span><br></pre></td></tr></table></figure><h4 id="创建php-fpm启动脚本、启动php-fpm"><a href="#创建php-fpm启动脚本、启动php-fpm" class="headerlink" title="创建php-fpm启动脚本、启动php-fpm"></a>创建php-fpm启动脚本、启动php-fpm</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/init.d/php-fpm</span><br><span class="line">贴入如下内容</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## BEGIN INIT INFO  </span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Provides:     nginx  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Required-Start:  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Required-Stop:  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default-Start:        2 3 4 5  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default-Stop:         0 1 6  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Short-Description: nginx  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Description: nginx server  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## END INIT INFO  </span></span></span><br><span class="line">. /lib/lsb/init-functions</span><br><span class="line">PROGRAM=/opt/php/sbin/php-fpm</span><br><span class="line">test -x $PROGRAM || exit 0</span><br><span class="line">case "$1" in</span><br><span class="line">  start)</span><br><span class="line">     log_begin_msg "Starting php-fpm server"</span><br><span class="line">     /opt/php/sbin/php-fpm -y /opt/php/etc/php-fpm.conf -c /opt/php/etc/php.ini </span><br><span class="line">     log_end_msg 0</span><br><span class="line">     ;;</span><br><span class="line">   stop)</span><br><span class="line">     PID=`cat /opt/php/var/run/php-fpm.pid`</span><br><span class="line">     log_begin_msg "Stopping php-fpm server"</span><br><span class="line">     if [ ! -z "$PID" ]; then</span><br><span class="line">        kill -15 $PID</span><br><span class="line">     fi</span><br><span class="line">     log_end_msg 0</span><br><span class="line">     ;;</span><br><span class="line">  restart)</span><br><span class="line">     $0 stop</span><br><span class="line">     $0 start</span><br><span class="line">     ;;</span><br><span class="line">  *)</span><br><span class="line">     log_success_msg "Usage: service php-fpm &#123;start|stop|restart&#125;"</span><br><span class="line">     exit 1</span><br><span class="line">esac</span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /etc/init.d/php-fpm</span><br><span class="line">sudo /etc/init.d/php-fpm start</span><br><span class="line">sudo update-rc.d php-fpm defaults</span><br></pre></td></tr></table></figure><h4 id="修改nginx配置文件，创建index-php，测试整合成功"><a href="#修改nginx配置文件，创建index-php，测试整合成功" class="headerlink" title="修改nginx配置文件，创建index.php，测试整合成功"></a>修改nginx配置文件，创建index.php，测试整合成功</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /opt/nginx/conf/nginx.conf</span><br><span class="line">修改如下内容</span><br><span class="line">user  www;</span><br><span class="line">pid        logs/nginx.pid;</span><br><span class="line">#默认首页index.php</span><br><span class="line">location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm index.php;</span><br><span class="line">        &#125;</span><br><span class="line">#php文件交给fastcgi处理</span><br><span class="line">location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">            fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">            fastcgi_index  index.php;</span><br><span class="line">            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">            include        fastcgi_params;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h4 id="创建测试页面index-php"><a href="#创建测试页面index-php" class="headerlink" title="创建测试页面index.php"></a>创建测试页面index.php</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /opt/nginx/html/index.php</span><br><span class="line">&lt;?php</span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h4 id="重启nginx"><a href="#重启nginx" class="headerlink" title="重启nginx"></a>重启nginx</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/nginx restart</span><br></pre></td></tr></table></figure><p>验证是否整合成功，地址栏：ip/index.php,如出现下图，整合成功。</p><p><img src="/articles/3131633d/2.png" alt="img"></p><h3 id="编译安装mysql"><a href="#编译安装mysql" class="headerlink" title="编译安装mysql"></a>编译安装mysql</h3><h4 id="安装依赖包-1"><a href="#安装依赖包-1" class="headerlink" title="安装依赖包"></a>安装依赖包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y install g++ cmake ncurses-dev</span><br><span class="line">cd /opt</span><br><span class="line">sudo wget http://heanet.dl.sourceforge.net/project/boost/boost/1.59.0/boost_1_59_0.tar.gz</span><br><span class="line">sudo tar zxvf boost_1_59_0.tar.gz</span><br></pre></td></tr></table></figure><h4 id="创建用户和用户组"><a href="#创建用户和用户组" class="headerlink" title="创建用户和用户组"></a>创建用户和用户组</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">创建mysql用户及用户组，创建mysql-data目录</span></span><br><span class="line">sudo groupadd mysql</span><br><span class="line">sudo useradd mysql -s /sbin/nologin -g mysql</span><br><span class="line">sudo mkdir -p /data/postmall/mysql/data</span><br><span class="line">cd /data/postmall/</span><br><span class="line">sudo chown -R mysql.mysql mysql</span><br></pre></td></tr></table></figure><h4 id="编译安装mysql-1"><a href="#编译安装mysql-1" class="headerlink" title="编译安装mysql"></a>编译安装mysql</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo wget http://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.13.tar.gz</span><br><span class="line">sudo tar zxvf mysql-5.7.13.tar.gz </span><br><span class="line">cd mysql-5.7.13/</span><br><span class="line">sudo cmake -DCMAKE_INSTALL_PREFIX=/opt/mysql -DMYSQL_DATADIR=/data/postmall/mysql/data -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci -DENABLED_LOCAL_INFILE=1 -DDOWNLOAD_BOOST=1 -DWITH_BOOST=/opt/boost_1_59_0</span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br><span class="line">cd /opt</span><br><span class="line">chown -R mysql.mysql mysql</span><br></pre></td></tr></table></figure><h4 id="初始化mysql"><a href="#初始化mysql" class="headerlink" title="初始化mysql"></a>初始化mysql</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/mysql/bin</span><br><span class="line">sudo ./mysqld --initialize --user=mysql --datadir=/data/postmall/mysql/data --basedir=/opt/mysql --socket=/var/mysql.sock</span><br><span class="line"><span class="meta">#</span><span class="bash">创建mysql配置文件和启动脚本</span></span><br><span class="line">sudo cp support-files/my-default.cnf /etc/my.cnf</span><br><span class="line">sudo cp support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line">sudo chmod +x /etc/init.d/mysqld</span><br><span class="line"><span class="meta">#</span><span class="bash">将mysql加入系统搜索路径（环境变量）</span></span><br><span class="line">cd /opt/mysql/bin</span><br><span class="line">sudo cp mysql /usr/bin/</span><br></pre></td></tr></table></figure><h4 id="启动并登陆mysql"><a href="#启动并登陆mysql" class="headerlink" title="启动并登陆mysql"></a>启动并登陆mysql</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/mysqld start</span><br></pre></td></tr></table></figure><h4 id="mysql主备配置"><a href="#mysql主备配置" class="headerlink" title="mysql主备配置:"></a>mysql主备配置:</h4><p> 修改主服务器master:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">vi  my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">log-bin=mysql-bin   </span><br><span class="line">server-id=1  </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">bind</span>-address            = 127.0.0.1</span></span><br></pre></td></tr></table></figure><p> 修改从服务器slave:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">vi /etc/my.cnf</span></span><br><span class="line">[mysqld]</span><br><span class="line">log-bin=mysql-bin  </span><br><span class="line">server-id=2</span><br></pre></td></tr></table></figure><p>在主服务器上建立帐户并授权slave:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash">GRANT REPLICATION SLAVE ON *.* to <span class="string">'zabbix'</span>@<span class="string">'%'</span> identified by <span class="string">'zabbix'</span>;</span></span><br></pre></td></tr></table></figure><p> 登录主服务器的mysql，查询master的状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash">show master status;</span></span><br><span class="line">   +------------------+----------+--------------+------------------+</span><br><span class="line">   | File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">   +------------------+----------+--------------+------------------+</span><br><span class="line">   | mysql-bin.000004 |      308 |              |                  |</span><br><span class="line">   +------------------+----------+--------------+------------------+</span><br><span class="line">   1 row in set (0.00 sec)</span><br><span class="line">   注：执行完此步骤后不要再操作主服务器MYSQL，防止主服务器状态值变化</span><br></pre></td></tr></table></figure><p>配置从服务器Slave：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash">change master to master_host=<span class="string">'172.25.200.55'</span>,master_user=<span class="string">'zabbix'</span>,master_password=<span class="string">'zabbix'</span>,</span></span><br><span class="line">        master_log_file='mysql-bin.000004',master_log_pos=308;   //注意不要断开，308数字前后无单引号。</span><br><span class="line"></span><br><span class="line"><span class="meta">Mysql&gt;</span><span class="bash">start slave;</span></span><br></pre></td></tr></table></figure><p>检查从服务器复制功能状态：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> show slave status\G</span></span><br><span class="line"></span><br><span class="line">   *************************** 1. row ***************************</span><br><span class="line"></span><br><span class="line">              Slave_IO_State: Waiting for master to send event</span><br><span class="line">              Master_Host: 172.25.200.55  //主服务器地址</span><br><span class="line">              Master_User: mysync   //授权帐户名，尽量避免使用root</span><br><span class="line">              Master_Port: 3306    //数据库端口，部分版本没有此行</span><br><span class="line">              Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000004</span><br><span class="line">              Read_Master_Log_Pos: 600     //#同步读取二进制日志的位置，大于等于Exec_Master_Log_Pos</span><br><span class="line">              Relay_Log_File: ddte-relay-bin.000003</span><br><span class="line">              Relay_Log_Pos: 251</span><br><span class="line">              Relay_Master_Log_File: mysql-bin.000004</span><br><span class="line">              Slave_IO_Running: Yes    //此状态必须YES</span><br><span class="line">              Slave_SQL_Running: Yes     //此状态必须YES</span><br><span class="line">                    ......</span><br><span class="line"></span><br><span class="line">注：Slave_IO及Slave_SQL进程必须正常运行，即YES状态，否则都是错误的状态(如：其中一个NO均属错误)。</span><br><span class="line"></span><br><span class="line">以上操作过程，主从服务器配置完成。</span><br></pre></td></tr></table></figure><h3 id="编译安装zabbix"><a href="#编译安装zabbix" class="headerlink" title="编译安装zabbix"></a>编译安装zabbix</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wget  http://jaist.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/3.0.3/zabbix-3.0.3.tar.gz</span><br><span class="line"></span><br><span class="line">tar -zxvf zabbix-3.0.3.tar.gz</span><br><span class="line">cd  zabbix-3.0.3/</span><br><span class="line">mkdir -p  /opt/zabbix</span><br><span class="line"></span><br><span class="line">[ 各种库文件安装 ]</span><br><span class="line">方法：sudo apt-get install make libmysqld-dev  libmysqlclient-dev   libxml2-dev   snmp  snmpd  libsnmp-dev   libcurl4-openssl-dev  openjdk-6-jdk</span><br><span class="line"></span><br><span class="line">[ 编译 ]</span><br><span class="line"></span><br><span class="line">./configure  --prefix=/opt/zabbix  --enable-java   --enable-server --enable-agent --with-mysql --enable-ipv6 --with-net-snmp --with-libcurl --with-libxml2</span><br><span class="line"></span><br><span class="line">[ 安装]</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h4 id="配置zabbix"><a href="#配置zabbix" class="headerlink" title="配置zabbix"></a>配置zabbix</h4><p>创建zabbix数据库，并导入zabbix数据库文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">创建数据库</span></span><br><span class="line">mysql -u root -p</span><br><span class="line">create database zabbix character set utf8;</span><br><span class="line">grant all on zabbix.* to 'zabbix'@'172.25.200.54' identified by 'zabbix';</span><br><span class="line">grant all on zabbix.* to 'zabbix'@'172.25.200.56' identified by 'zabbix';</span><br><span class="line">grant all on zabbix.* to 'zabbix'@'localhost' identified by 'zabbix';</span><br><span class="line">flush privileges;</span><br><span class="line">exit;</span><br><span class="line"><span class="meta">#</span><span class="bash">导入数据库文件</span></span><br><span class="line">cd /opt</span><br><span class="line">sudo wget http://repo.zabbix.com/zabbix/3.0/ubuntu/pool/main/z/zabbix/zabbix_3.0.3.orig.tar.gz </span><br><span class="line">sudo tar zxvf zabbix_3.0.3.orig.tar.gz</span><br><span class="line">cd zabbix-3.0.3/database/mysql</span><br><span class="line">mysql -uzabbix -pzabbix zabbix &lt; schema.sql</span><br><span class="line">mysql -uzabbix -pzabbix zabbix &lt; images.sql</span><br><span class="line">mysql -uzabbix -pzabbix zabbix &lt; data.sql</span><br></pre></td></tr></table></figure><h4 id="配置zabbix-server-conf"><a href="#配置zabbix-server-conf" class="headerlink" title="配置zabbix_server.conf"></a>配置zabbix_server.conf</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/zabbix/etc/zabbix_server.conf</span><br><span class="line">LogFile=/var/log/zabbix/zabbix_server.log  #如没有/var/log/zabbix目录，请创建</span><br><span class="line">DBHost=172.25.200.55</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=zabbix</span><br></pre></td></tr></table></figure><h4 id="配置php-ini"><a href="#配置php-ini" class="headerlink" title="配置php.ini"></a>配置php.ini</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /opt/php/etc/php.ini</span><br><span class="line">post_max_size = 16M</span><br><span class="line">max_execution_time = 300</span><br><span class="line">max_input_time = 300</span><br></pre></td></tr></table></figure><h4 id="配置zabbix页面"><a href="#配置zabbix页面" class="headerlink" title="配置zabbix页面"></a>配置zabbix页面</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/zabbix-3.0.3/frontends/php/</span><br><span class="line">sudo cp -a . /data/zabbix/</span><br><span class="line">cd /data/</span><br><span class="line">sudo chown -R www.www zabbix </span><br><span class="line">mv /zabbix/conf/zabbix.conf.php.example  /zabbix/conf/zabbix.conf.php</span><br><span class="line">sudo vim /var/www/html/zabbix/conf/zabbix.conf.php</span><br><span class="line">修改项</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">DB[<span class="string">'DATABASE'</span>] = <span class="string">'zabbix'</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">DB[<span class="string">'USER'</span>] = <span class="string">'zabbix'</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">DB[<span class="string">'PASSWORD'</span>] = <span class="string">'zabbix'</span></span></span><br></pre></td></tr></table></figure><h4 id="配置nginx-conf"><a href="#配置nginx-conf" class="headerlink" title="配置nginx.conf"></a>配置nginx.conf</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /opt/nginx/conf/nginx.conf</span><br><span class="line"> location / &#123;</span><br><span class="line">            root   /data/postmall;</span><br><span class="line">            index  index.html index.htm index.php;</span><br><span class="line">        &#125;</span><br><span class="line"> location ~ \.php$ &#123;</span><br><span class="line">            root           /data/postmall;</span><br><span class="line">            fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">            fastcgi_index  index.php;</span><br><span class="line">            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">            include        fastcgi_params;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h4 id="重启zabbix、php-fpm-、nginx"><a href="#重启zabbix、php-fpm-、nginx" class="headerlink" title="重启zabbix、php-fpm 、nginx"></a>重启zabbix、php-fpm 、nginx</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/zabbix_server restart</span><br><span class="line">sudo /etc/init.d/php-fpm restart</span><br><span class="line">sudo /etc/init.d/nginx restart</span><br></pre></td></tr></table></figure><h3 id="安装grafana"><a href="#安装grafana" class="headerlink" title="安装grafana"></a>安装grafana</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> wget https://grafanarel.s3.amazonaws.com/builds/grafana_3.1.0-1468321182_amd64.deb</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install -y adduser libfontconfig</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo dpkg -i grafana_3.1.0-1468321182_amd64.deb</span></span><br><span class="line">grafana-cli plugins list-remote</span><br><span class="line">grafana-cli plugins install alexanderzobnin-zabbix-app</span><br><span class="line">service grafana-server restart</span><br></pre></td></tr></table></figure><h3 id="安装zatree"><a href="#安装zatree" class="headerlink" title="安装zatree"></a>安装zatree</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/BillWang139967/zatree.git</span><br><span class="line">cd zatree/zabbix-3.0.x/</span><br><span class="line">bash start.sh</span><br><span class="line">执行过程中需要输入zabbix admin的账号和密码</span><br><span class="line">调整php页面文件（header.php，echart.php，peckvalue.php，zabbix_zatree.php）详情请参考wiki上《Zatree for zabbix 3.0.x》及其附件。</span><br></pre></td></tr></table></figure></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script><script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/articles/3131633d.html">zabbix3.0.x在lnmp全编译安装</a></p><p><span>文章作者:</span><a href="/" title="访问 WanDouDuoDuo 的个人博客">WanDouDuoDuo</a></p><p><span>发布时间:</span>2019年06月17日 - 09:06</p><p><span>最后更新:</span>2019年08月07日 - 10:08</p><p><span>原始链接:</span><a href="/articles/3131633d.html" title="zabbix3.0.x在lnmp全编译安装">http://wandouduoduo.github.io/articles/3131633d.html</a><span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://wandouduoduo.github.io/articles/3131633d.html" aria-label="复制成功！"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>原创技术分享，您的支持将鼓励我继续创作</div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="/images/wechatpay.png" alt="WanDouDuoDuo 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="/images/alipay.jpg" alt="WanDouDuoDuo 支付宝"><p>支付宝</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Zabbix/" rel="tag"><i class="fa fa-tag"></i> Zabbix</a></div><div class="post-widgets"><div class="social_share"><div><div class="bdsharebuttonbox"><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a><a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a><a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a><a href="#" class="bds_more" data-cmd="more"></a><a class="bds_count" data-cmd="count"></a></div><script>window._bd_share_config={common:{bdText:"",bdMini:"2",bdMiniList:!1,bdPic:""},share:{bdSize:"16",bdStyle:"0"},image:{viewList:["tsina","douban","sqq","qzone","weixin","twi","fbook"],viewText:"分享到：",viewSize:"16"}}</script><script>with(document)(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="/static/api/js/share.js?cdnversion="+~(-new Date/36e5)</script></div></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/articles/4c04639e.html" rel="next" title="zabbix api调用步骤"><i class="fa fa-chevron-left"></i> zabbix api调用步骤</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/articles/3f5bc800.html" rel="prev" title="zabbix-proxy安装部署">zabbix-proxy安装部署<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="gitalk-container"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/me.jpg" alt="WanDouDuoDuo"><p class="site-author-name" itemprop="name">WanDouDuoDuo</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">89</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">20</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">40</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/wandouduoduo" title="GitHub &rarr; https://github.com/wandouduoduo" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:wandouduoduo@163.com" title="E-Mail &rarr; mailto:wandouduoduo@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://gitee.com/wandouduoduo" title="Gitee &rarr; https://gitee.com/wandouduoduo" rel="noopener" target="_blank"><i class="fa fa-fw fa-heartbeat"></i> Gitee</a></span><span class="links-of-author-item"><a href="https://weibo.com/u/1989032071/home?topnav=1&wvr=6" title="微博 &rarr; https://weibo.com/u/1989032071/home?topnav=1&wvr=6" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> 微博</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 推荐阅读</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://www.runoob.com/" title="https://www.runoob.com/" rel="noopener" target="_blank">菜鸟教程</a></li><li class="links-of-blogroll-item"> <a href="https://code.ziqiangxuetang.com/" title="https://code.ziqiangxuetang.com/" rel="noopener" target="_blank">自强学堂</a></li></ul></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#目的"><span class="nav-number">1.</span> <span class="nav-text">目的</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#环境版本："><span class="nav-number">2.</span> <span class="nav-text">环境版本：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#lnmp系统："><span class="nav-number">2.0.1.</span> <span class="nav-text">lnmp系统：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#监控系统："><span class="nav-number">2.0.2.</span> <span class="nav-text">监控系统：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#安装路径："><span class="nav-number">2.0.3.</span> <span class="nav-text">安装路径：</span></a></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#安装"><span class="nav-number">3.</span> <span class="nav-text">安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装nginx-php"><span class="nav-number">3.1.</span> <span class="nav-text">安装nginx + php</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装依赖包"><span class="nav-number">3.1.1.</span> <span class="nav-text">安装依赖包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#编译安装nginx"><span class="nav-number">3.1.2.</span> <span class="nav-text">编译安装nginx</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装php"><span class="nav-number">3.2.</span> <span class="nav-text">安装php</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装bzip2"><span class="nav-number">3.2.1.</span> <span class="nav-text">安装bzip2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#安装zlib"><span class="nav-number">3.2.2.</span> <span class="nav-text">安装zlib</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#安装libmcrypt"><span class="nav-number">3.2.3.</span> <span class="nav-text">安装libmcrypt</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#安装freetype"><span class="nav-number">3.2.4.</span> <span class="nav-text">安装freetype</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#安装jpegsrc（zabbix需要）"><span class="nav-number">3.2.5.</span> <span class="nav-text">安装jpegsrc（zabbix需要）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#编译安装php"><span class="nav-number">3.2.6.</span> <span class="nav-text">编译安装php</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#整合nginx-php"><span class="nav-number">3.3.</span> <span class="nav-text">整合nginx + php</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建php、php-fpm配置文件"><span class="nav-number">3.3.1.</span> <span class="nav-text">创建php、php-fpm配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建php-fpm启动脚本、启动php-fpm"><span class="nav-number">3.3.2.</span> <span class="nav-text">创建php-fpm启动脚本、启动php-fpm</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#修改nginx配置文件，创建index-php，测试整合成功"><span class="nav-number">3.3.3.</span> <span class="nav-text">修改nginx配置文件，创建index.php，测试整合成功</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建测试页面index-php"><span class="nav-number">3.3.4.</span> <span class="nav-text">创建测试页面index.php</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#重启nginx"><span class="nav-number">3.3.5.</span> <span class="nav-text">重启nginx</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编译安装mysql"><span class="nav-number">3.4.</span> <span class="nav-text">编译安装mysql</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装依赖包-1"><span class="nav-number">3.4.1.</span> <span class="nav-text">安装依赖包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建用户和用户组"><span class="nav-number">3.4.2.</span> <span class="nav-text">创建用户和用户组</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#编译安装mysql-1"><span class="nav-number">3.4.3.</span> <span class="nav-text">编译安装mysql</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#初始化mysql"><span class="nav-number">3.4.4.</span> <span class="nav-text">初始化mysql</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启动并登陆mysql"><span class="nav-number">3.4.5.</span> <span class="nav-text">启动并登陆mysql</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mysql主备配置"><span class="nav-number">3.4.6.</span> <span class="nav-text">mysql主备配置:</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编译安装zabbix"><span class="nav-number">3.5.</span> <span class="nav-text">编译安装zabbix</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#配置zabbix"><span class="nav-number">3.5.1.</span> <span class="nav-text">配置zabbix</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置zabbix-server-conf"><span class="nav-number">3.5.2.</span> <span class="nav-text">配置zabbix_server.conf</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置php-ini"><span class="nav-number">3.5.3.</span> <span class="nav-text">配置php.ini</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置zabbix页面"><span class="nav-number">3.5.4.</span> <span class="nav-text">配置zabbix页面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置nginx-conf"><span class="nav-number">3.5.5.</span> <span class="nav-text">配置nginx.conf</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#重启zabbix、php-fpm-、nginx"><span class="nav-number">3.5.6.</span> <span class="nav-text">重启zabbix、php-fpm 、nginx</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装grafana"><span class="nav-number">3.6.</span> <span class="nav-text">安装grafana</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装zatree"><span class="nav-number">3.7.</span> <span class="nav-text">安装zatree</span></a></li></ol></li></div></div></div><script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script><script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script><div class="widget-wrap"><div id="myCanvasContainer" class="widget tagcloud"><canvas width="250" height="250" id="resCanvas" style=""><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ai/">Ai</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ansible/">Ansible</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cloud/">Cloud</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cmdb/">Cmdb</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Confd/">Confd</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/">Django</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dns/">Dns</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elk/">Elk</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flask/">Flask</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go/">Go</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Http/">Http</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Iptables/">Iptables</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/">Jenkins</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kali/">Kali</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mesos/">Mesos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/">MongoDB</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/">Mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Network/">Network</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Open-falcon/">Open-falcon</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Openldap/">Openldap</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Postgresql/">Postgresql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Prometheus/">Prometheus</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sentry/">Sentry</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ssh/">Ssh</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Stackstorm/">Stackstorm</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Supervisor/">Supervisor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat/">Tomcat</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Uwsgi/">Uwsgi</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web/">Web</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/">Windows</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zabbix/">Zabbix</a><span class="tag-list-count">4</span></li></ul></canvas></div></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span><span class="with-love" id="animate"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">WanDouDuoDuo</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">568k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">8:36</span></div><div class="theme-info"><div class="powered-by"></div> <span class="post-count">博客全站共216.4k字</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/js/src/utils.js?v=6.7.0"></script><script src="/js/src/motion.js?v=6.7.0"></script><script src="/js/src/affix.js?v=6.7.0"></script><script src="/js/src/schemes/pisces.js?v=6.7.0"></script><script src="/js/src/scrollspy.js?v=6.7.0"></script><script src="/js/src/post-details.js?v=6.7.0"></script><script src="/js/src/bootstrap.js?v=6.7.0"></script><script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script src="//cdn.jsdelivr.net/npm/js-md5@0.7.3/src/md5.min.js"></script><script>var gitalk=new Gitalk({clientID:"ad83725549e82facce82",clientSecret:"b67c2056b52d0447f1d78f413f268a5b853e8a6e",repo:"wandouduoduo.github.io",owner:"wandouduoduo",admin:["wandouduoduo"],id:md5(location.pathname),distractionFreeMode:"true"});gitalk.render("gitalk-container")</script><script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(e,t){var n=$("<div>").addClass("highlight-wrap");$(t).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(e){var t=$(this).parent().find(".code").find(".line").map(function(e,t){return $(t).text()}).toArray().join("\n"),n=document.createElement("textarea"),o=document.createRange(),a=window.getSelection(),i=window.pageYOffset||document.documentElement.scrollTop;n.style.top=i+"px",n.style.position="absolute",n.style.opacity="0",n.value=t,n.textContent=t,n.contentEditable=!0,n.readOnly=!1,document.body.appendChild(n),o.selectNode(n),a.removeAllRanges(),a.addRange(o),n.setSelectionRange(0,t.length),document.execCommand("copy")?$(this).text("复制成功"):$(this).text("复制失败"),n.blur(),$(this).blur()})).on("mouseleave",function(e){var t=$(this).find(".copy-btn");setTimeout(function(){t.text("复制")},300)}).append(t)})</script><canvas class="fireworks" style="position:fixed;left:0;top:0;z-index:1;pointer-events:none"></canvas><script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script><script type="text/javascript" src="/js/src/fireworks.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/shizuku.model.json"},display:{position:"right",width:150,height:300},mobile:{show:!0},log:!1})</script></body></html>