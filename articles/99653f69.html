<!DOCTYPE html><html class="theme-next gemini" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link rel="stylesheet" href="/lib/pace/pace-theme-flash.min.css?v=1.0.2"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"><link rel="stylesheet" href="/css/main.css?v=6.7.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/next-favicon-32.png?v=6.7.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/next-favicon-16.png?v=6.7.0"><link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"6.7.0",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!1,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="介绍zabbix支持的主要监控方式： ​        zabbix主要Agent，Trapper，SNMP，JMX，IPMI这几种监控方式，本文章主要通过监控理论和实际操作测试等方式来简单介绍这几种方式的监控原理和优缺点等 。下面对几种监控方式的监控原理进行介绍："><meta name="keywords" content="Zabbix"><meta property="og:type" content="article"><meta property="og:title" content="详解zabbix的监控方式"><meta property="og:url" content="http://wandouduoduo.github.io/articles/99653f69.html"><meta property="og:site_name" content="豌豆多多"><meta property="og:description" content="介绍zabbix支持的主要监控方式： ​        zabbix主要Agent，Trapper，SNMP，JMX，IPMI这几种监控方式，本文章主要通过监控理论和实际操作测试等方式来简单介绍这几种方式的监控原理和优缺点等 。下面对几种监控方式的监控原理进行介绍："><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/1.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/2.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/3.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/4.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/5.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/6.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/7.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/8.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/9.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/10.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/11.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/12.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/13.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/14.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/15.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/16.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/17.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/18.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/19.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/20.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/21.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/22.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/23.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/24.png"><meta property="og:image" content="http://wandouduoduo.github.io/articles/99653f69/25.png"><meta property="og:updated_time" content="2019-08-07T02:06:44.090Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="详解zabbix的监控方式"><meta name="twitter:description" content="介绍zabbix支持的主要监控方式： ​        zabbix主要Agent，Trapper，SNMP，JMX，IPMI这几种监控方式，本文章主要通过监控理论和实际操作测试等方式来简单介绍这几种方式的监控原理和优缺点等 。下面对几种监控方式的监控原理进行介绍："><meta name="twitter:image" content="http://wandouduoduo.github.io/articles/99653f69/1.png"><link rel="alternate" href="/atom.xml" title="豌豆多多" type="application/atom+xml"><link rel="canonical" href="http://wandouduoduo.github.io/articles/99653f69.html"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>详解zabbix的监控方式 | 豌豆多多</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/wandouduoduo" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">豌豆多多</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Deveops Study Notes</p></div><div class="site-nav-toggle"> <button aria-label="切换导航栏"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-guide"><a href="/guide/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>指南</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://wandouduoduo.github.io/articles/99653f69.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="WanDouDuoDuo"><meta itemprop="description" content><meta itemprop="image" content="/images/me.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="豌豆多多"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">详解zabbix的监控方式</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-06-05 09:30:02" itemprop="dateCreated datePublished" datetime="2019-06-05T09:30:02+08:00">2019-06-05</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2019-08-07 10:06:44" itemprop="dateModified" datetime="2019-08-07T10:06:44+08:00">2019-08-07</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/应用运维/" itemprop="url" rel="index"><span itemprop="name">应用运维</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/应用运维/监控积累/" itemprop="url" rel="index"><span itemprop="name">监控积累</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i> 阅读次数：<span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span title="本文字数">26k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">23 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>zabbix支持的主要监控方式：</p><p>​ zabbix主要Agent，Trapper，SNMP，JMX，IPMI这几种监控方式，本文章主要通过监控理论和实际操作测试等方式来简单介绍这几种方式的监控原理和优缺点等 。下面对几种监控方式的监控原理进行介绍：</p><a id="more"></a><h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><h3 id="Agent监控方式"><a href="#Agent监控方式" class="headerlink" title="Agent监控方式"></a>Agent监控方式</h3><p>​ 在Agent监控方式下，zabbix-agent会主动收集本机的监控信息并通过TCP协议与zabbix-server传递信息。Agent监控方式分为主动和被动模式。在被动模式下，zabbix-agent监听10050端口，等待zabbix-server的监控信息收集信息请求；在主动模式下，zabbix-agent收集监控信息并通过10050端口主动将数据传给zabbix-server所在服务器的10051端口。</p><p>​ 优点：</p><p>​ （1）是zabbix最常用的监控方式，监测指标深入细致有针对性。</p><p>​ （2）内置监控功能强大，内置监控项目丰富。</p><p>​ （3）TCP方式实现通讯，可靠性也有保证。</p><p>​ 缺点：</p><p>​ （1）需要在被监控机器上安装zabbix-agent客户端，部署相对麻烦，最初需要逐个机器安装代理软件</p><p>​ （2）zabbix-agent客户端运行在被监控机上，会收集本机信息</p><h3 id="Trapper监控方式"><a href="#Trapper监控方式" class="headerlink" title="Trapper监控方式"></a>Trapper监控方式</h3><p>​ Trapper监控方式使用zabbix-sender程序主动向zabbix-server发送数据。key的名称和发送的数据内容都可以灵活定义。发送的信息采用JSON格式，遵循zabbix-sender协议。可以自定义脚本利用zabbix-sender协议来zabbix-server发送信息。</p><p>​ 优点：</p><p>​ （1）不需要在被监控机器上安装zabbix-agent</p><p>​ （2）不收集被监控机器的信息</p><p>​ （3）可以自定义发送的信息内容</p><p>​ （4）可以使用自定义脚本发送信息</p><p>​ 缺点：</p><p>​ （1）需要自定义发送的信息内容</p><p>​ （2）无内置监控项目</p><h3 id="SNMP监控方式"><a href="#SNMP监控方式" class="headerlink" title="SNMP监控方式"></a>SNMP监控方式</h3><p>​ SNMP全称Simple Network Management Protocol，即网络管理协议，包括进程管理和被管理设备两部分。作为一种国际通用的网络管理协议被广泛的应用于各种交换机，路由器等网络设备的管理上，而现在也越来越多被用于对服务器的监控上。</p><p>​ 优点：</p><p>​ （1）服务器一旦部署SNMPAgent，任何能实现SNMP协议的软件都可以对其进行监测。</p><p>​ （2）通过这种手段进行监测不需知道被监测服务器的用户名和密码，比较安全。</p><p>​ 缺点：</p><p>​ （1）很多服务器并非默认安装SNMPAgent，如果通过这种方式监测则需要对所有服务器安装部署。</p><p>​ （2）能监测的参数指标比较固定不够深入，无法满足用户的特殊需求。</p><p>​ （3）由于SNMP协议是通过UDP方式实现的。在网络状况不佳的情况下其可靠性能以保证。</p><h3 id="JMX监控方式"><a href="#JMX监控方式" class="headerlink" title="JMX监控方式"></a>JMX监控方式</h3><p>​ JMX，全称Java Management Extensions，即Java管理拓展，是Java平台为应用程序，设备，系统等植入管理功能的框架。在zabbix中，JMX数据的获取由zabbix-java-gateway代理程序来负责数据的采集。</p><p>​ 优点：</p><p>​ （1）可以详细的监控各类Java程序的运行状态</p><p>​ 缺点：</p><p>​ （1）被监控机上需要安装zabbix-java-gateway</p><h3 id="IPMI监控方式"><a href="#IPMI监控方式" class="headerlink" title="IPMI监控方式"></a>IPMI监控方式</h3><p>​ IPMI，全称Interlligent Platform Management Interface，即智能平台管理接口，原本是Intel架构中企业系统的周边设备所采用的一种工业标准，以后成为业界通用的标准。用户可以利用IPMI监控服务器的物理特性，如温度，电压，电扇工作状态，电源供应以及机箱***等指标。</p><p>​ 根据以上对zabbix各主要监控方式的梳理，结论如下：</p><p>​ （1）根据被监控机器的环境和客户要求选用适当的监控方式，可同时配合多种监控方式。</p><p>​ （2）有条件在监控机上部署zabbix-agent客户端时，该方法为第一选择，因为其功能强大且配置相对简便。</p><p>​ （3）需要自定义脚本或者监控信息时，可使用Trapper方式，即使用zabbix-sender程序或者自定义脚本遵循zabbix-sender协议，已JSON形式，通过TCP发送自定义信息。</p><h2 id="方式的实现"><a href="#方式的实现" class="headerlink" title="方式的实现"></a>方式的实现</h2><h3 id="Agent监控方式-1"><a href="#Agent监控方式-1" class="headerlink" title="Agent监控方式"></a>Agent监控方式</h3><h4 id="1、通过Agent方式监控Linux服务器"><a href="#1、通过Agent方式监控Linux服务器" class="headerlink" title="1、通过Agent方式监控Linux服务器"></a>1、通过Agent方式监控Linux服务器</h4><p>​ （1）需要在Linux服务器上安装zabbix-agent客户端安装包，需要先导入软件安装源:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh http://repo.zabbix.com/zabbix/3.5/rhel/7/x86_64/zabbix-release-3.5-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure><p>​ （2） 使用yum源安装zabbix-agent</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install zabbix-agent</span><br></pre></td></tr></table></figure><p>​ （3）zabbix客户端配置</p><p>​ 编辑zabbix_server配置文件并启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/zabbix/zabbix_agent.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">修改以下配置信息：</span></span><br><span class="line"></span><br><span class="line">Server=192.168.40.134      #zabbix服务端IP地址</span><br><span class="line"></span><br><span class="line">ServerActive=192.168.40.134    #zabbix服务端IP地址</span><br><span class="line"></span><br><span class="line">ListenPort=10050          #监控服务端口</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">启动zabbix-agent服务</span></span><br><span class="line"></span><br><span class="line">systemctl start zabbix-agent</span><br></pre></td></tr></table></figure><p>​ （4）zabbix服务器端添加被监控主机</p><p>​ 选择“配置”-“主机”，然后选择“创建主机”: <img src="/articles/99653f69/1.png" alt="image.png"></p><p>​ 选择添加的模板： <img src="/articles/99653f69/2.png" alt="image.png"></p><p>​ 添加主机成功：</p><p><img src="/articles/99653f69/3.png" alt="image.png"></p><h4 id><a href="#" class="headerlink" title=" "></a></h4><h4 id="2、通过Agent方式监控windows服务器"><a href="#2、通过Agent方式监控windows服务器" class="headerlink" title="2、通过Agent方式监控windows服务器"></a>2、通过Agent方式监控windows服务器</h4><p>​ （1）下载Windows的zabbix客户端</p><p>​ 下载地址：<a href="https://www.zabbix.com/download_agents" target="_blank" rel="noopener">Zabbix官网</a></p><p>​ 选择需要下载的windows版本客户端：</p><p><img src="/articles/99653f69/4.png" alt="image.png"></p><p> （2）确定被监控主机的系统是32位还是64位</p><p>​ 右键“此电脑”，查看操作系统版本.</p><p>​ <img src="/articles/99653f69/5.png" alt="image.png"></p><p>（3）windows上安装agent</p><p>​ 根据系统信息直接选择msi或zip压缩包，在此需要注意和server端一致。然后解压安装即可.</p><p>（4）修改配置文件</p><p>​ 需要修改的内容为：LogFile、Server、Hostname、ServerActive这几个参数。具体配置如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Server=192.168.40.134</span><br><span class="line">ServerActive=192.168.40.134</span><br><span class="line">Hostname=Windows host </span><br><span class="line">ListenPort=10050</span><br></pre></td></tr></table></figure><p>（5）安装zabbix-agent客户端程序</p><p>​ 用管理员权限打开CMD，进入到zabbix的应用程序目录，执行安装命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zabbix_agentd.exe -c D:\zabbix-agent\conf\zabbix_agentd.win.conf -i</span><br></pre></td></tr></table></figure><p>​ 安装成功后，执行运行命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zabbix_agentd.exe -c D:\zabbix-agent\conf\zabbix_agentd.win.conf -s</span><br></pre></td></tr></table></figure><p>​ <img src="/articles/99653f69/6.png" alt="image.png"></p><p> （6）在zabbix server端配置agent</p><p>​ 在server端，选择 配置-主机 界面，然后点击“创建主机”，在添加主机的界面，输入被监控主机客户端的信息。</p><p><img src="/articles/99653f69/7.png" alt="image.png"></p><p>​ 点击“添加”，然后过一段时间查看主机状态</p><p><img src="/articles/99653f69/8.png" alt="image.png"></p><p>​</p><h3 id="zabbix-Trapper监控方式"><a href="#zabbix-Trapper监控方式" class="headerlink" title="zabbix Trapper监控方式"></a>zabbix Trapper监控方式</h3><h4 id="1、zabbix-Trapper-工作原理"><a href="#1、zabbix-Trapper-工作原理" class="headerlink" title="1、zabbix Trapper 工作原理"></a>1、zabbix Trapper 工作原理</h4><p>​ zabbix获取数据时有时会出现超时，如果一些数据需要执行较长的时间才能获取的话，那么zabbix会出现异常，考虑到这种情况，zabbix增加了Trapper功能，客户端自己提交数据给zabbix。</p><p>​ Trapper是被监控主机主动发送数据给zabbix server，与主动模式的区别是不需要安装客户端；Trapper方式发送数据是以主机名处理，不是IP地址，所以主机名要唯一。在配置监控项时候Type of information项要选择text，否则会报not support错误。</p><p>​ Trapper工作模式中，使用zabbix监控类型zabbix Trapper（可以称为zabbix捕捉器），在zabbix服务器上必须有一个捕捉项目，然后需要配合zabbix_sender把数据推送给zabbix服务器，该程序由zabbix发行版本自带，源码包解压后在bin目录下，配合crontab定期发送数据给zabbix server。</p><p>​ zabbix_sender是一个命令行工具，可以用来发送zabbix服务器处理性能数据。该工具通常用于长时间运行的用户 脚本，用于定期发送可用性和性能数据。</p><h4 id="2、zabbix-sender命令："><a href="#2、zabbix-sender命令：" class="headerlink" title="2、zabbix_sender命令："></a>2、zabbix_sender命令：</h4><p>​ rpm导入zabbix_sender安装源：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh http://repo.zabbix.com/zabbix/3.5/rhel/7/x86_64/zabbix-release-3.5-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure><p>​ <img src="/articles/99653f69/9.png" alt="image.png"></p><p>​ 使用rpm安装，默认在/bin目录下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cd /bin</span><br><span class="line">ls</span><br><span class="line">./zabbix_sender</span><br><span class="line"></span><br><span class="line">​ usage:zabbix_sender [-Vhv] &#123;[-zpsl] -ko | [-zpl] -T -i &lt;file&gt; -r&#125; [-c&lt;file&gt;]</span><br><span class="line"></span><br><span class="line">​ 参数说明：</span><br><span class="line">​ -c --config&lt;file&gt;       配置文件绝对路径</span><br><span class="line">​ -z --zabbix-server&lt;server&gt;   zabbix server的IP地址</span><br><span class="line">​ -p --port&lt;server port&gt;   zabbix server 端口默认10051</span><br><span class="line">​ -s --host &lt;hostname&gt;   主机名，zabbix客户端zabbix.agentd.conf配置文件中定义的Hostname（不是服务器的hostname），不是客户端主机的IP地址</span><br><span class="line">​ -l -- source-address &lt;IP address&gt;  源IP</span><br><span class="line">​ -k --key &lt;key&gt;  监控项的key值</span><br><span class="line">​ -o --value&lt;key value&gt; key值</span><br><span class="line">​ -i --input-file&lt;input file&gt;  从文件里面读取hostname、key、value一行为一条数据，使用空格作为分隔符，如果主机名带空格，那么请使用双引号包起来</span><br><span class="line">​ -T --with-timestamps   一行一条数据，空格作为分隔符：&lt;hostname&gt; &lt;key&gt; &lt;timestamp&gt; &lt;value&gt;，配合 --input-file option，timestamp为unix时间戳</span><br><span class="line">​ -r --real-time      将数据实时提交给服务器</span><br><span class="line">​ -v --verbose     详细模式， -vv 更详细</span><br></pre></td></tr></table></figure><h4 id="3、监控项配置"><a href="#3、监控项配置" class="headerlink" title="3、监控项配置"></a>3、监控项配置</h4><p>​ 创建监控项（Configuration –&gt; Template –&gt; Items –&gt; Create item 或Configuration –&gt; Host –&gt; Items –&gt; Create item）</p><p>​ （1）选择“配置”-“主机”-“新建主机”,添加zabbix-Trapper 客户端的用户名： <img src="/articles/99653f69/10.png" alt="image.png"></p><p>​ （2） 添加完主机后，添加监控项，选择刚添加的主机，点击“监控项”，然后点击“创建监控项”：</p><p>​ 添加监控信息，然后点击更新：</p><p>​ <img src="/articles/99653f69/11.png" alt="image.png"></p><p>​ （3）客户端使用zabbix_sender发送数据</p><p>​ 客户端设备操作：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> cd /bin</span><br><span class="line">./zabbix_sender -s 192.168.40.134 -z 192.168.40.129 -k trappertest11 -o test</span><br></pre></td></tr></table></figure><p>​ -vv 可以显示具体信息，这里提示无法连接到zabbix server的10051端口</p><p>​ 服务端：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -anop | grep -i zabbix</span><br></pre></td></tr></table></figure><p>​ 未开放外网的10051端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ListenIP=127.0.0.1,192.168.40.134</span><br><span class="line">LIstenPort=10051</span><br><span class="line"></span><br><span class="line">systemctl restart zabbix-service</span><br><span class="line">netstat -anop | grep -i zabbix</span><br></pre></td></tr></table></figure><p>​ 客户端： <img src="/articles/99653f69/12.png" alt="image.png"></p><p>​</p><h3 id="Zabbix-SNMP监控方式"><a href="#Zabbix-SNMP监控方式" class="headerlink" title="Zabbix SNMP监控方式"></a>Zabbix SNMP监控方式</h3><h4 id="1、SNMP监控介绍"><a href="#1、SNMP监控介绍" class="headerlink" title="1、SNMP监控介绍"></a>1、SNMP监控介绍</h4><p>​ 如果要监控打印机、路由器、交换机、UPS等设备，肯定不能使用zabbix agentd，因为他们不能安装软件，但是一般都支持SNMP协议，可以使用SNMP来监控。SNMP检查基于UDP协议。</p><p>​ 注意事项：如果监控基于SNMPv3协议的设备，确保msgAuthoritativeEngineID（通常叫做snmpEngineID或“Engine ID”）是唯一的。</p><p>​ 以前SNMPv3协议只支持MD5和DES加密，从zabbix2.2开始支持SHA与AES加密协议。</p><h4 id="2、Zabbix-SNMP监控Linux操作系统"><a href="#2、Zabbix-SNMP监控Linux操作系统" class="headerlink" title="2、Zabbix SNMP监控Linux操作系统"></a>2、Zabbix SNMP监控Linux操作系统</h4><p>​ （1）zabbix服务器端需要先安装SNMP服务</p><p>​ 使用yum源在线安装SNMP服务配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install net-snmp*</span><br></pre></td></tr></table></figure><p>​ (2) 配置SNMP配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/snmp/snmpd.conf</span><br><span class="line"></span><br><span class="line">proc mountd   </span><br><span class="line">proc ntalkd  4</span><br><span class="line">proc sendmail  10  1</span><br><span class="line">disk / 10000</span><br><span class="line">load  12 14  14</span><br><span class="line">view  systemview  included  .1.3.6.1.2.1.1</span><br><span class="line">view  systemview  included  .1.3.6.1.2.1.25.1.1</span><br><span class="line">view  systemview  included  .1</span><br></pre></td></tr></table></figure><p>​ (3) 设置开机启动SNMP：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chkconfig  snmpd on</span><br><span class="line">chkconfig --list | grep snmpd</span><br><span class="line">/etc/init.d/snmpd start     启动snmp服务</span><br></pre></td></tr></table></figure><p>​ （4）zabbix服务器使用snmpwalk命令测试被监控计算机名</p><p>​ 2c是指采用SNMP V2版本，192.168.40.134是指监控设备开启了SNMP服务，否则会获取失败，sysName是指被监控设备的计算机名。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">snmpwalk -v 2c -c public 192.168.40.134 sysName</span><br></pre></td></tr></table></figure><p>​ （5）被监控设备安装SNMP服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install net-snmp*</span><br></pre></td></tr></table></figure><p>​ <img src="/articles/99653f69/13.png" alt="image.png"></p><p>​ (6) 配置SNMP配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">view    systemview    included   .1.3.6.1.2.1.1</span><br><span class="line">view    systemview    included   .1.3.6.1.2.1.25.1.1</span><br><span class="line">view    systemview    included   .1</span><br></pre></td></tr></table></figure><p>​ com2sec notConfigUser default zabbix #zabbix是被监控的团体名 public团体名称可以修改成自己设置的字符串也可以使用默认public，default字符串默认是所有IP地址都可以访问，如果把default修改成192.168.40.134（zabbix服务器IP地址），表示只允许zabbix服务器访问这台被监控电脑的SNMP服务。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl  enable snmped</span><br><span class="line">systemctl stop firewalld   关闭防火墙</span><br><span class="line">/etc/init.d/snmpd start    启动SNMP服务 </span><br><span class="line">systemctl stop firewalld   关闭防火墙</span><br></pre></td></tr></table></figure><p>​ /etc/init.d/snmpd start 启动SNMP服务</p><p>（7）zabbix服务端web界面添加主机</p><p>​ 选择“配置”-“主机”-“创建主机”，添加要被监控设备的主机信息：</p><p><img src="/articles/99653f69/14.png" alt="image.png"></p><p>​ 添加模块：<img src="/articles/99653f69/15.png" alt="image.png"></p><p>​ 添加宏： <img src="/articles/99653f69/16.png" alt="image.png"></p><h4 id="3、zabbix-SNMP监控windows系统"><a href="#3、zabbix-SNMP监控windows系统" class="headerlink" title="3、zabbix SNMP监控windows系统"></a>3、zabbix SNMP监控windows系统</h4><p>​ （1）windows系统启动SNMP功能：</p><p>​ 选择“控制面板”-“程序”-“启用或关闭windows功能”，选择“简单网络管理协议（SNMP）”</p><p>​ <img src="/articles/99653f69/17.png" alt="image.png"></p><p>​ （2）右击“计算机”-“管理”-“服务”，选择“snmp server”服务器，右击“属性”：</p><p>​ <img src="/articles/99653f69/18.png" alt="image.png"></p><p>​ <img src="/articles/99653f69/19.png" alt="image.png"></p><p>（3）zabbix 服务端web界面，选择“配置”-“主机”，然后点击“创建主机”</p><p>​ <img src="/articles/99653f69/20.png" alt="image.png"></p><p>​ <img src="/articles/99653f69/21.png" alt="image.png"></p><p>​ 大概需要等待五分钟左右，查看主机监控成功。</p><h4 id="4、zabbix-SNMP-监控网设备"><a href="#4、zabbix-SNMP-监控网设备" class="headerlink" title="4、zabbix SNMP 监控网设备"></a>4、zabbix SNMP 监控网设备</h4><p>​ “配置”-“主机”-“创建主机”，添写要监控的设备信息：</p><p>​ <img src="/articles/99653f69/22.png" alt="image.png"></p><p>​ <img src="/articles/99653f69/23.png" alt="image.png"></p><h3 id="zabbix-JMX监控方式"><a href="#zabbix-JMX监控方式" class="headerlink" title="zabbix JMX监控方式"></a>zabbix JMX监控方式</h3><h4 id="1、zabbix-JMX-简介"><a href="#1、zabbix-JMX-简介" class="headerlink" title="1、zabbix JMX 简介"></a>1、zabbix JMX 简介</h4><p>​ 在企业中，很多程序是基于Java来编写的，java程序运行在JVM之上，而JVM自己就可以监听在某个套接字上，将自己内部的状态信息输出出去，所以监控服务器只需要直接连接JVM的套接字就可以获取到Java进程的相关信息，不需要通过Agent、SNMP；可是zabbix是没办法自己连接JVM套接字的，也就是说，zabbix自身是不能够作为客户端来链接该套接字的。所以，就需要额外安装一个服务来连接JVM套接字的。这个服务就是zabbix-java-gateway.x86_64(Java网关）；可以通过该网关来监听多个JVM；zabbix-agent-gateway可以是一个单独的主机，可以和zabbix server安装到一台主机上；</p><h4 id="2、zabbix-server-安装java-gateway"><a href="#2、zabbix-server-安装java-gateway" class="headerlink" title="2、zabbix server 安装java gateway"></a>2、zabbix server 安装java gateway</h4><p>​ zabbix提供了一个java gateway的应用去监控jmx（Java Management Extensions，即Java管理扩展）是一个为应用程序、设备、系统等植入管理功能的框架。JMX可以跨越一系列异构操作平台、系统体系结构和网络传输协议，灵活的开发无缝集成的系统、网络和服务管理应用。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y java java-devel zabbix-java-gateway</span><br></pre></td></tr></table></figure><h4 id="3、添加java环境"><a href="#3、添加java环境" class="headerlink" title="3、添加java环境"></a>3、添加java环境</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line">​ JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.171-8.b10.el7_5.x86_64</span><br><span class="line">​ PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">​ CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">​ export JAVA_HOME</span><br><span class="line">​ export PATH</span><br><span class="line">​ export CLASSPATH</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">加载环境：</span></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><h4 id="4、修改java-gateway配置文件"><a href="#4、修改java-gateway配置文件" class="headerlink" title="4、修改java-gateway配置文件"></a>4、修改java-gateway配置文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">grep ^[a-Z]  /etc/zabbix/zabbix_java_gateway.conf</span><br><span class="line">cd /etc/zabbix</span><br><span class="line">vim zabbix_java_gateway.conf  修改以下信息：</span><br><span class="line"></span><br><span class="line">​ LISTEN_IP="0.0.0.0"</span><br><span class="line">​ LISTEN_PORT=10052</span><br><span class="line">​ PID_FILE="/var/run/zabbix/zabbix_java.pid"</span><br><span class="line">​ START_POLLERS=5</span><br><span class="line">​ TIMEOUT=3</span><br></pre></td></tr></table></figure><h4 id="5、重启java-gateway服务"><a href="#5、重启java-gateway服务" class="headerlink" title="5、重启java-gateway服务"></a>5、重启java-gateway服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart zabbix-java-gateway</span><br></pre></td></tr></table></figure><h4 id="6、修改zabbix-server配置文件"><a href="#6、修改zabbix-server配置文件" class="headerlink" title="6、修改zabbix_server配置文件"></a>6、修改zabbix_server配置文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">find / -name zabbix_java_gateway</span><br><span class="line">vim /usr/sbin/zabbix_java_gateway    修改以下配置信息</span><br><span class="line"></span><br><span class="line">​ JavaGateway=192.168.40.131&lt;br&gt;</span><br><span class="line">​ JavaGatewayPort=10052&lt;br&gt;</span><br><span class="line">​ StartJavaPollers=5</span><br></pre></td></tr></table></figure><h4 id="7、重启zabbix-server服务"><a href="#7、重启zabbix-server服务" class="headerlink" title="7、重启zabbix_server服务"></a>7、重启zabbix_server服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart zabbix-server</span><br></pre></td></tr></table></figure><h4 id="8、客户端配置"><a href="#8、客户端配置" class="headerlink" title="8、客户端配置"></a>8、客户端配置</h4><p>​ 在Tomcat下的/bin/catalina.sh文件中添加以下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CATALINA_OPTS="$CATALINA_OPTS -Djavax.management.builder.initial= -Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.port=12345 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=192.168.40.131"</span><br></pre></td></tr></table></figure><p>​ 重启Tomcat进程：</p><p>​ <img src="/articles/99653f69/24.png" alt="image.png"></p><h4 id="9、zabbix中添加监控"><a href="#9、zabbix中添加监控" class="headerlink" title="9、zabbix中添加监控"></a>9、zabbix中添加监控</h4><p>​ 选择配置：主机-模板-选择-模板-：<img src="/articles/99653f69/25.png" alt="image.png"></p><h3 id="zabbix-IPMI监控方式"><a href="#zabbix-IPMI监控方式" class="headerlink" title="zabbix IPMI监控方式"></a>zabbix IPMI监控方式</h3><h4 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h4><p>​ IPMI（Intelligent PlatformManagement Interface）既智能平台管理接口是使硬件管理具备“智能化”的新一代通用接口标准。用户可以利用IPMI监视服务器的物理特性，如温度、电压、电扇工作状态、电源供应以及机箱入侵等。Ipmi最大的优势在于它是独立于 CPU BIOS 和OS的，所以用户无论在开机还是关机的状态下，只要接通电源就可以实现对服务器的监控。Ipmi是一种规范的标准，其中最重要的物理部件就是BMC（Baseboard Management Controller），一种嵌入式管理微控制器，它相当于整个平台管理的“大脑”，通过它 ipmi 可以监控各个传感器的数据并记录各种事件的日志。</p><h4 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h4><p>​ 使用 ipmi 的先决条件，想要实现对服务器的 ipmi 管理，必须在硬件、OS、管理工具等几个方面都满足：</p><p>​ a.服务器硬件本身提供对 ipmi 的支持目前惠普、戴尔和 NEC 等大多数厂商的服务器都支持IPMI 1.5，但并不是所有服务器都支持，所以应该先通过产品手册或在 BIOS 中确定服务器是否支持 ipmi，也就是说服务器在主板上要具有 BMC 等嵌入式的管理微控制器。</p><p>​ b.操作系统提供相应的 ipmi 驱动通过操作系统监控服务器自身的 ipmi 信息时需要系统内核提供相应的支持，linux 系统通过内核对OpenIPMI（ipmi 驱动）的支持来提供对 ipmi 的系统接口。</p><h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><p>日常监控中使用IPMI的方式不多，在此不举例说明了。</p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script><script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/articles/99653f69.html">详解zabbix的监控方式</a></p><p><span>文章作者:</span><a href="/" title="访问 WanDouDuoDuo 的个人博客">WanDouDuoDuo</a></p><p><span>发布时间:</span>2019年06月05日 - 09:06</p><p><span>最后更新:</span>2019年08月07日 - 10:08</p><p><span>原始链接:</span><a href="/articles/99653f69.html" title="详解zabbix的监控方式">http://wandouduoduo.github.io/articles/99653f69.html</a><span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://wandouduoduo.github.io/articles/99653f69.html" aria-label="复制成功！"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>原创技术分享，您的支持将鼓励我继续创作</div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="/images/wechatpay.png" alt="WanDouDuoDuo 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="/images/alipay.jpg" alt="WanDouDuoDuo 支付宝"><p>支付宝</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Zabbix/" rel="tag"><i class="fa fa-tag"></i> Zabbix</a></div><div class="post-widgets"><div class="social_share"><div><div class="bdsharebuttonbox"><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a><a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a><a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a><a href="#" class="bds_more" data-cmd="more"></a><a class="bds_count" data-cmd="count"></a></div><script>window._bd_share_config={common:{bdText:"",bdMini:"2",bdMiniList:!1,bdPic:""},share:{bdSize:"16",bdStyle:"0"},image:{viewList:["tsina","douban","sqq","qzone","weixin","twi","fbook"],viewText:"分享到：",viewSize:"16"}}</script><script>with(document)(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="/static/api/js/share.js?cdnversion="+~(-new Date/36e5)</script></div></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/articles/e67f5ae2.html" rel="next" title="nginx+uwsgi+flask搭建web服务"><i class="fa fa-chevron-left"></i> nginx+uwsgi+flask搭建web服务</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/articles/98a39ceb.html" rel="prev" title="proxy_pass后加不加斜杠的区别">proxy_pass后加不加斜杠的区别<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="gitalk-container"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/me.jpg" alt="WanDouDuoDuo"><p class="site-author-name" itemprop="name">WanDouDuoDuo</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">94</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">20</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">41</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/wandouduoduo" title="GitHub &rarr; https://github.com/wandouduoduo" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:wandouduoduo@163.com" title="E-Mail &rarr; mailto:wandouduoduo@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://gitee.com/wandouduoduo" title="Gitee &rarr; https://gitee.com/wandouduoduo" rel="noopener" target="_blank"><i class="fa fa-fw fa-heartbeat"></i> Gitee</a></span><span class="links-of-author-item"><a href="https://weibo.com/u/1989032071/home?topnav=1&wvr=6" title="微博 &rarr; https://weibo.com/u/1989032071/home?topnav=1&wvr=6" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> 微博</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 推荐阅读</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://www.runoob.com/" title="https://www.runoob.com/" rel="noopener" target="_blank">菜鸟教程</a></li><li class="links-of-blogroll-item"> <a href="https://code.ziqiangxuetang.com/" title="https://code.ziqiangxuetang.com/" rel="noopener" target="_blank">自强学堂</a></li></ul></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#介绍"><span class="nav-number">1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优缺点"><span class="nav-number">2.</span> <span class="nav-text">优缺点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Agent监控方式"><span class="nav-number">2.1.</span> <span class="nav-text">Agent监控方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Trapper监控方式"><span class="nav-number">2.2.</span> <span class="nav-text">Trapper监控方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SNMP监控方式"><span class="nav-number">2.3.</span> <span class="nav-text">SNMP监控方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JMX监控方式"><span class="nav-number">2.4.</span> <span class="nav-text">JMX监控方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IPMI监控方式"><span class="nav-number">2.5.</span> <span class="nav-text">IPMI监控方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方式的实现"><span class="nav-number">3.</span> <span class="nav-text">方式的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Agent监控方式-1"><span class="nav-number">3.1.</span> <span class="nav-text">Agent监控方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1、通过Agent方式监控Linux服务器"><span class="nav-number">3.1.1.</span> <span class="nav-text">1、通过Agent方式监控Linux服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#null"><span class="nav-number">3.1.2.</span><span class="nav-text"></span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2、通过Agent方式监控windows服务器"><span class="nav-number">3.1.3.</span> <span class="nav-text">2、通过Agent方式监控windows服务器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zabbix-Trapper监控方式"><span class="nav-number">3.2.</span> <span class="nav-text">zabbix Trapper监控方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1、zabbix-Trapper-工作原理"><span class="nav-number">3.2.1.</span> <span class="nav-text">1、zabbix Trapper 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2、zabbix-sender命令："><span class="nav-number">3.2.2.</span> <span class="nav-text">2、zabbix_sender命令：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3、监控项配置"><span class="nav-number">3.2.3.</span> <span class="nav-text">3、监控项配置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Zabbix-SNMP监控方式"><span class="nav-number">3.3.</span> <span class="nav-text">Zabbix SNMP监控方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1、SNMP监控介绍"><span class="nav-number">3.3.1.</span> <span class="nav-text">1、SNMP监控介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2、Zabbix-SNMP监控Linux操作系统"><span class="nav-number">3.3.2.</span> <span class="nav-text">2、Zabbix SNMP监控Linux操作系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3、zabbix-SNMP监控windows系统"><span class="nav-number">3.3.3.</span> <span class="nav-text">3、zabbix SNMP监控windows系统</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4、zabbix-SNMP-监控网设备"><span class="nav-number">3.3.4.</span> <span class="nav-text">4、zabbix SNMP 监控网设备</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zabbix-JMX监控方式"><span class="nav-number">3.4.</span> <span class="nav-text">zabbix JMX监控方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1、zabbix-JMX-简介"><span class="nav-number">3.4.1.</span> <span class="nav-text">1、zabbix JMX 简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2、zabbix-server-安装java-gateway"><span class="nav-number">3.4.2.</span> <span class="nav-text">2、zabbix server 安装java gateway</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3、添加java环境"><span class="nav-number">3.4.3.</span> <span class="nav-text">3、添加java环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4、修改java-gateway配置文件"><span class="nav-number">3.4.4.</span> <span class="nav-text">4、修改java-gateway配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5、重启java-gateway服务"><span class="nav-number">3.4.5.</span> <span class="nav-text">5、重启java-gateway服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6、修改zabbix-server配置文件"><span class="nav-number">3.4.6.</span> <span class="nav-text">6、修改zabbix_server配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7、重启zabbix-server服务"><span class="nav-number">3.4.7.</span> <span class="nav-text">7、重启zabbix_server服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8、客户端配置"><span class="nav-number">3.4.8.</span> <span class="nav-text">8、客户端配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9、zabbix中添加监控"><span class="nav-number">3.4.9.</span> <span class="nav-text">9、zabbix中添加监控</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zabbix-IPMI监控方式"><span class="nav-number">3.5.</span> <span class="nav-text">zabbix IPMI监控方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#介绍-1"><span class="nav-number">3.5.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#条件"><span class="nav-number">3.5.2.</span> <span class="nav-text">条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#实例"><span class="nav-number">3.5.3.</span> <span class="nav-text">实例</span></a></li></ol></li></ol></li></ol></div></div></div><script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script><script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script><div class="widget-wrap"><div id="myCanvasContainer" class="widget tagcloud"><canvas width="250" height="250" id="resCanvas" style=""><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ai/">Ai</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ansible/">Ansible</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cloud/">Cloud</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cmdb/">Cmdb</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Confd/">Confd</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Confluence/">Confluence</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/">Django</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dns/">Dns</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elk/">Elk</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flask/">Flask</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go/">Go</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Http/">Http</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Iptables/">Iptables</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/">Jenkins</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kali/">Kali</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mesos/">Mesos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/">MongoDB</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/">Mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Network/">Network</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Open-falcon/">Open-falcon</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Openldap/">Openldap</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Postgresql/">Postgresql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Prometheus/">Prometheus</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sentry/">Sentry</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ssh/">Ssh</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Stackstorm/">Stackstorm</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Supervisor/">Supervisor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat/">Tomcat</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Uwsgi/">Uwsgi</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web/">Web</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/">Windows</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zabbix/">Zabbix</a><span class="tag-list-count">4</span></li></ul></canvas></div></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span><span class="with-love" id="animate"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">WanDouDuoDuo</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">576k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">8:44</span></div><div class="theme-info"><div class="powered-by"></div> <span class="post-count">博客全站共219.3k字</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/js/src/utils.js?v=6.7.0"></script><script src="/js/src/motion.js?v=6.7.0"></script><script src="/js/src/affix.js?v=6.7.0"></script><script src="/js/src/schemes/pisces.js?v=6.7.0"></script><script src="/js/src/scrollspy.js?v=6.7.0"></script><script src="/js/src/post-details.js?v=6.7.0"></script><script src="/js/src/bootstrap.js?v=6.7.0"></script><script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script src="//cdn.jsdelivr.net/npm/js-md5@0.7.3/src/md5.min.js"></script><script>var gitalk=new Gitalk({clientID:"ad83725549e82facce82",clientSecret:"b67c2056b52d0447f1d78f413f268a5b853e8a6e",repo:"wandouduoduo.github.io",owner:"wandouduoduo",admin:["wandouduoduo"],id:md5(location.pathname),distractionFreeMode:"true"});gitalk.render("gitalk-container")</script><script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(e,t){var n=$("<div>").addClass("highlight-wrap");$(t).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(e){var t=$(this).parent().find(".code").find(".line").map(function(e,t){return $(t).text()}).toArray().join("\n"),n=document.createElement("textarea"),o=document.createRange(),a=window.getSelection(),i=window.pageYOffset||document.documentElement.scrollTop;n.style.top=i+"px",n.style.position="absolute",n.style.opacity="0",n.value=t,n.textContent=t,n.contentEditable=!0,n.readOnly=!1,document.body.appendChild(n),o.selectNode(n),a.removeAllRanges(),a.addRange(o),n.setSelectionRange(0,t.length),document.execCommand("copy")?$(this).text("复制成功"):$(this).text("复制失败"),n.blur(),$(this).blur()})).on("mouseleave",function(e){var t=$(this).find(".copy-btn");setTimeout(function(){t.text("复制")},300)}).append(t)})</script><canvas class="fireworks" style="position:fixed;left:0;top:0;z-index:1;pointer-events:none"></canvas><script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script><script type="text/javascript" src="/js/src/fireworks.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/shizuku.model.json"},display:{position:"right",width:150,height:300},mobile:{show:!0},log:!1})</script></body></html>