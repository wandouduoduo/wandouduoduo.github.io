<!DOCTYPE html><html class="theme-next gemini" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link rel="stylesheet" href="/lib/pace/pace-theme-flash.min.css?v=1.0.2"><meta name="google-site-verification" content="igfxU5A6c_28PmCJ5Zw1kMMKNCL3wvbBMwUqfOJ4kKg"><meta name="baidu-site-verification" content="dGZSCiVN1E"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"><link rel="stylesheet" href="/css/main.css?v=6.7.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/next-favicon-32.png?v=6.7.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/next-favicon-16.png?v=6.7.0"><link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"6.7.0",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!1,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="安装StackStorm作为RPM和Debs分发用于RedHat / CentOS和Ubuntu Linux系统，以及Docker镜像。您可以使用脚本在单个系统上自动安装和配置所有组件，也可以按照操作系统的手动说明进行操作。 以下是选项概述：  一键安装：运行我们的安装脚本，在单个系统上进行所有组件的固定安装。这是我们推荐的入门方式。有关详细信息，请参阅下面的“ 快速安装  手动安装：有定制需求吗"><meta name="keywords" content="Stackstorm"><meta property="og:type" content="article"><meta property="og:title" content="Stackstorm之一键安装"><meta property="og:url" content="https://wandouduoduo.gitee.io/articles/c8f378bd.html"><meta property="og:site_name" content="豌豆多多"><meta property="og:description" content="安装StackStorm作为RPM和Debs分发用于RedHat / CentOS和Ubuntu Linux系统，以及Docker镜像。您可以使用脚本在单个系统上自动安装和配置所有组件，也可以按照操作系统的手动说明进行操作。 以下是选项概述：  一键安装：运行我们的安装脚本，在单个系统上进行所有组件的固定安装。这是我们推荐的入门方式。有关详细信息，请参阅下面的“ 快速安装  手动安装：有定制需求吗"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://wandouduoduo.gitee.io/articles/c8f378bd/1.png"><meta property="og:image" content="https://wandouduoduo.gitee.io/articles/c8f378bd/2.png"><meta property="og:updated_time" content="2019-10-31T10:52:45.615Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Stackstorm之一键安装"><meta name="twitter:description" content="安装StackStorm作为RPM和Debs分发用于RedHat / CentOS和Ubuntu Linux系统，以及Docker镜像。您可以使用脚本在单个系统上自动安装和配置所有组件，也可以按照操作系统的手动说明进行操作。 以下是选项概述：  一键安装：运行我们的安装脚本，在单个系统上进行所有组件的固定安装。这是我们推荐的入门方式。有关详细信息，请参阅下面的“ 快速安装  手动安装：有定制需求吗"><meta name="twitter:image" content="https://wandouduoduo.gitee.io/articles/c8f378bd/1.png"><link rel="alternate" href="/atom.xml" title="豌豆多多" type="application/atom+xml"><link rel="canonical" href="https://wandouduoduo.gitee.io/articles/c8f378bd.html"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>Stackstorm之一键安装 | 豌豆多多</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><link rel="stylesheet" href="/dist/APlayer.min.css"><div id="aplayer"></div><script type="text/javascript" src="/dist/APlayer.min.js"></script><script type="text/javascript" src="/dist/music.js"></script><div class="container sidebar-position-left page-post-detail"><div class="headband"></div> <a href="https://github.com/wandouduoduo" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#fd6c6c;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">豌豆多多</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Senior O & M Architect</p></div><div class="site-nav-toggle"> <button aria-label="切换导航栏"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://wandouduoduo.gitee.io/articles/c8f378bd.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="WanDouDuoDuo"><meta itemprop="description" content="沪漂资深运维架构师的呕心笔记"><meta itemprop="image" content="/images/me.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="豌豆多多"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Stackstorm之一键安装</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-06-12 17:52:24" itemprop="dateCreated datePublished" datetime="2019-06-12T17:52:24+08:00">2019-06-12</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2019-10-31 18:52:45" itemprop="dateModified" datetime="2019-10-31T18:52:45+08:00">2019-10-31</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/自动化/" itemprop="url" rel="index"><span itemprop="name">自动化</span></a></span> ， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/自动化/Stackstorm/" itemprop="url" rel="index"><span itemprop="name">Stackstorm</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i> 阅读次数：<span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span title="本文字数">36k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">33 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><div id="vip-container"><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>StackStorm作为RPM和Debs分发用于RedHat / CentOS和Ubuntu Linux系统，以及Docker镜像。您可以使用脚本在单个系统上自动安装和配置所有组件，也可以按照操作系统的手动说明进行操作。</p><p>以下是选项概述：</p><ul><li><p><strong>一键安装：</strong>运行我们的安装脚本，在单个系统上进行所有组件的固定安装。这是我们推荐的入门方式。有关详细信息，请参阅下面的“ <a href="https://docs.stackstorm.com/install/index.html#ref-one-line-install" target="_blank" rel="noopener">快速安装</a></p></li><li><p><strong>手动安装：</strong>有定制需求吗？也许您的服务器无法访问Internet？或者只是不喜欢使用脚本安装？阅读适用于您的操作系统的手册安装说明（<a href="https://docs.stackstorm.com/install/deb.html" target="_blank" rel="noopener">Ubuntu 14</a> <a href="https://docs.stackstorm.com/install/rhel6.html" target="_blank" rel="noopener">/</a> <a href="https://docs.stackstorm.com/install/deb.html" target="_blank" rel="noopener">16</a>，<a href="https://docs.stackstorm.com/install/rhel6.html" target="_blank" rel="noopener">RHEL / CentOS 6</a>，<a href="https://docs.stackstorm.com/install/rhel7.html" target="_blank" rel="noopener">RHEL / CentOS 7</a>），并根据您的需要进行调整。以下是为StackStorm repos设置内部镜像的一些<a href="https://stackstorm.com/2017/02/10/installing-stackstorm-offline-systems/" target="_blank" rel="noopener">其他指导</a>。</p></li><li><p><strong>Ansible Playbooks：</strong>如果您是Ansible用户，请查看这些<a href="https://docs.stackstorm.com/install/ansible.html" target="_blank" rel="noopener">Ansible Playbooks</a>以安装StackStorm。非常适合StackStorm的可重复，一致，幂等安装。</p></li><li><p><strong>高可用性将</strong>业务关键自动化任务委托给像StackStorm这样的系统会对该系统产生更高的要求。StackStorm可以在HA模式下运行以确保满足这些需求。 <a href="https://docs.stackstorm.com/install/k8s_ha.html" target="_blank" rel="noopener">Kubernetes中的StackStorm HA集群 - BETA将</a>整个复杂的基础架构自动化为可重现的蓝图。</p><a id="more"></a></li></ul><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="https://docs.stackstorm.com/overview.html" target="_blank" rel="noopener">官方文档</a></p><h2 id="系统要求"><a href="#系统要求" class="headerlink" title="系统要求"></a>系统要求</h2><p>StackStorm需要Ubuntu，RHEL或CentOS Linux。并且仅支持64位架构。</p><p><img src="/articles/c8f378bd/1.png" alt></p><p>这是测试和部署StackStorm的建议最小大小：</p><p><img src="/articles/c8f378bd/2.png" alt></p><h2 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h2><h3 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h3><p>RHEL 7 / CentOS 7</p><h3 id="调整SELinux策略"><a href="#调整SELinux策略" class="headerlink" title="调整SELinux策略"></a>调整SELinux策略</h3><p>如果您的系统在执行模式下具有SELinux，请按照这些说明调整SELinux策略。这是成功安装所必需的。如果您对这些政策不满意，可能需要根据您的安全措施进行调整</p><ul><li>首先检查SELinux是否处于执行模式：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getenforce</span><br></pre></td></tr></table></figure><ul><li>如果上一个命令返回“Enforcing”，则运行以下命令：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> SELINUX management tools, not available <span class="keyword">for</span> some minimal installations</span></span><br><span class="line">sudo yum install -y policycoreutils-python</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Allow network access <span class="keyword">for</span> nginx</span></span><br><span class="line">sudo setsebool -P httpd_can_network_connect 1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Allow RabbitMQ to use port <span class="string">'25672'</span>, otherwise it will fail to start</span></span><br><span class="line">sudo semanage port --list | grep -q 25672 || sudo semanage port -a -t amqp_port_t -p tcp 25672</span><br></pre></td></tr></table></figure><h3 id="安装依赖项"><a href="#安装依赖项" class="headerlink" title="安装依赖项"></a>安装依赖项</h3><p><strong>提示：目前支持的MongoDB版本是3.4。这是安装程序脚本安装的版本。MongoDB 3.6及更新版目前不支持StackStorm。将在StackStorm的未来版本中添加对4.0的支持</strong></p><p>安装MongoDB，RabbitMQ和PostgreSQL：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">sudo yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Add key and repo <span class="keyword">for</span> the latest stable MongoDB (3.4)</span></span><br><span class="line">sudo rpm --import https://www.mongodb.org/static/pgp/server-3.4.asc</span><br><span class="line">sudo sh -c "cat &lt;&lt;EOT &gt; /etc/yum.repos.d/mongodb-org-3.4.repo</span><br><span class="line">[mongodb-org-3.4]</span><br><span class="line">name=MongoDB Repository</span><br><span class="line">baseurl=https://repo.mongodb.org/yum/redhat/7/mongodb-org/3.4/x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://www.mongodb.org/static/pgp/server-3.4.asc</span><br><span class="line">EOT"</span><br><span class="line"></span><br><span class="line">sudo yum -y install crudini</span><br><span class="line">sudo yum -y install mongodb-org</span><br><span class="line">sudo yum -y install rabbitmq-server</span><br><span class="line">sudo systemctl start mongod rabbitmq-server</span><br><span class="line">sudo systemctl enable mongod rabbitmq-server</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Install and configure postgres</span></span><br><span class="line">sudo yum -y install postgresql-server postgresql-contrib postgresql-devel</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Initialize PostgreSQL</span></span><br><span class="line">sudo postgresql-setup initdb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Make localhost connections to use an MD5-encrypted password <span class="keyword">for</span> authentication</span></span><br><span class="line">sudo sed -i "s/\(host.*all.*all.*127.0.0.1\/32.*\)ident/\1md5/" /var/lib/pgsql/data/pg_hba.conf</span><br><span class="line">sudo sed -i "s/\(host.*all.*all.*::1\/128.*\)ident/\1md5/" /var/lib/pgsql/data/pg_hba.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Start PostgreSQL service</span></span><br><span class="line">sudo systemctl start postgresql</span><br><span class="line">sudo systemctl enable postgresql</span><br></pre></td></tr></table></figure><h3 id="设置存储库"><a href="#设置存储库" class="headerlink" title="设置存储库"></a>设置存储库</h3><p>以下脚本将检测您的平台和体系结构，并设置相应的StackStorm存储库。它还将添加用于包签名的GPG密钥。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://packagecloud.io/install/repositories/StackStorm/stable/script.rpm.sh | sudo bash</span><br></pre></td></tr></table></figure><h3 id="安装StackStorm组件"><a href="#安装StackStorm组件" class="headerlink" title="安装StackStorm组件"></a>安装StackStorm组件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y st2 st2mistral</span><br></pre></td></tr></table></figure><p>如果您没有在同一系统上运行RabbitMQ，MongoDB或PostgreSQL，或者更改了默认值，请调整以下设置：</p><ul><li><p>RabbitMQ连接<code>/etc/st2/st2.conf</code>和<code>/etc/mistral/mistral.conf</code></p></li><li><p>MongoDB在 <code>/etc/st2/st2.conf</code></p></li><li><p>PostgreSQL在 <code>/etc/mistral/mistral.conf</code></p></li></ul><h3 id="设置数据存储区加密"><a href="#设置数据存储区加密" class="headerlink" title="设置数据存储区加密"></a>设置数据存储区加密</h3><p>在<a href="https://docs.stackstorm.com/datastore.html" target="_blank" rel="noopener">key-value存储</a>，允许用户存储加密的值（秘密）。这些是使用对称加密（AES256）存储的。要生成加密密钥，请运行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DATASTORE_ENCRYPTION_KEYS_DIRECTORY="/etc/st2/keys"</span><br><span class="line">DATASTORE_ENCRYPTION_KEY_PATH="$&#123;DATASTORE_ENCRYPTION_KEYS_DIRECTORY&#125;/datastore_key.json"</span><br><span class="line"></span><br><span class="line">sudo mkdir -p $&#123;DATASTORE_ENCRYPTION_KEYS_DIRECTORY&#125;</span><br><span class="line">sudo st2-generate-symmetric-crypto-key --key-path $&#123;DATASTORE_ENCRYPTION_KEY_PATH&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Make sure only st2 user can <span class="built_in">read</span> the file</span></span><br><span class="line">sudo chgrp st2 $&#123;DATASTORE_ENCRYPTION_KEYS_DIRECTORY&#125;</span><br><span class="line">sudo chmod o-r $&#123;DATASTORE_ENCRYPTION_KEYS_DIRECTORY&#125;</span><br><span class="line">sudo chgrp st2 $&#123;DATASTORE_ENCRYPTION_KEY_PATH&#125;</span><br><span class="line">sudo chmod o-r $&#123;DATASTORE_ENCRYPTION_KEY_PATH&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> path to the key file <span class="keyword">in</span> the config</span></span><br><span class="line">sudo crudini --set /etc/st2/st2.conf keyvalue encryption_key_path $&#123;DATASTORE_ENCRYPTION_KEY_PATH&#125;</span><br><span class="line"></span><br><span class="line">sudo st2ctl restart-component st2api</span><br></pre></td></tr></table></figure><h3 id="设置Mistral数据库"><a href="#设置Mistral数据库" class="headerlink" title="设置Mistral数据库"></a>设置Mistral数据库</h3><p>运行以下命令以设置Mistral PostgreSQL数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Create Mistral DB <span class="keyword">in</span> PostgreSQL</span></span><br><span class="line">cat &lt;&lt; EHD | sudo -u postgres psql</span><br><span class="line">CREATE ROLE mistral WITH CREATEDB LOGIN ENCRYPTED PASSWORD 'StackStorm';</span><br><span class="line">CREATE DATABASE mistral OWNER mistral;</span><br><span class="line">EHD</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Setup Mistral DB tables, etc.</span></span><br><span class="line">/opt/stackstorm/mistral/bin/mistral-db-manage --config-file /etc/mistral/mistral.conf upgrade head</span><br><span class="line"><span class="meta">#</span><span class="bash"> Register mistral actions</span></span><br><span class="line">/opt/stackstorm/mistral/bin/mistral-db-manage --config-file /etc/mistral/mistral.conf populate | grep -v -e openstack -e keystone -e ironicclient</span><br></pre></td></tr></table></figure><h3 id="配置SSH和SUDO"><a href="#配置SSH和SUDO" class="headerlink" title="配置SSH和SUDO"></a>配置SSH和SUDO</h3><p>要运行本地和远程shell操作，StackStorm使用特殊系统用户（默认情况下<code>stanley</code>）。对于远程Linux操作，使用SSH。我们建议在所有远程主机上配置基于公钥的SSH访问。我们还建议配置对localhost的SSH访问以运行示例和测试。</p><ul><li>创建StackStorm系统用户，启用无密码sudo，并设置对“localhost”的ssh访问，以便可以在本地测试基于SSH的操作。您需要提升权限才能执行此操作：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Create an SSH system user (default `stanley` user may already exist)</span></span><br><span class="line">sudo useradd stanley</span><br><span class="line">sudo mkdir -p /home/stanley/.ssh</span><br><span class="line">sudo chmod 0700 /home/stanley/.ssh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Generate ssh keys</span></span><br><span class="line">sudo ssh-keygen -f /home/stanley/.ssh/stanley_rsa -P ""</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Authorize key-based access</span></span><br><span class="line">sudo sh -c 'cat /home/stanley/.ssh/stanley_rsa.pub &gt;&gt; /home/stanley/.ssh/authorized_keys'</span><br><span class="line">sudo chown -R stanley:stanley /home/stanley/.ssh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Enable passwordless sudo</span></span><br><span class="line">sudo sh -c 'echo "stanley    ALL=(ALL)       NOPASSWD: SETENV: ALL" &gt;&gt; /etc/sudoers.d/st2'</span><br><span class="line">sudo chmod 0440 /etc/sudoers.d/st2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Make sure `Defaults requiretty` is disabled <span class="keyword">in</span> `/etc/sudoers`</span></span><br><span class="line">sudo sed -i -r "s/^Defaults\s+\+?requiretty/# Defaults +requiretty/g" /etc/sudoers</span><br></pre></td></tr></table></figure><ul><li><p>在远程主机上配置SSH访问并启用无密码sudo，StackStorm将通过SSH运行远程操作。使用上一步中生成的公钥，按照<a href="https://docs.stackstorm.com/install/config/config.html#config-configure-ssh" target="_blank" rel="noopener">配置SSH中</a>的说明进行<a href="https://docs.stackstorm.com/install/config/config.html#config-configure-ssh" target="_blank" rel="noopener">操作</a>。要控制Windows框，请为<a href="https://docs.stackstorm.com/install/config/winrm_runners.html" target="_blank" rel="noopener">Windows运行程序</a>配置访问权限 。</p></li><li><p>如果您使用的是其他用户或SSH密钥的路径，则需要在以下位置更改此部分<code>/etc/st2/st2.conf</code>：</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[system_user]</span><br><span class="line">user = stanley</span><br><span class="line">ssh_key_file = /home/stanley/.ssh/stanley_rsa</span><br></pre></td></tr></table></figure><h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><ul><li>启动服务：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo st2ctl start</span><br></pre></td></tr></table></figure><ul><li>注册传感器，规则和操作：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo st2ctl reload</span><br></pre></td></tr></table></figure><h3 id="校验"><a href="#校验" class="headerlink" title="校验"></a>校验</h3><p>以下命令将测试StackStorm安装。他们都应该成功完成：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">st2 --version</span><br><span class="line"></span><br><span class="line">st2 -h</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> List the actions from a <span class="string">'core'</span> pack</span></span><br><span class="line">st2 action list --pack=core</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Run a <span class="built_in">local</span> shell <span class="built_in">command</span></span></span><br><span class="line">st2 run core.local -- date -R</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> See the execution results</span></span><br><span class="line">st2 execution list</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Fire a remote comand via SSH (Requires passwordless SSH)</span></span><br><span class="line">st2 run core.remote hosts='localhost' -- uname -a</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Install a pack</span></span><br><span class="line">st2 pack install st2</span><br></pre></td></tr></table></figure><p>使用supervisor脚本管理StackStorm服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo st2ctl start|stop|status|restart|restart-component|reload|clean</span><br></pre></td></tr></table></figure><p>以愉快地使用StackStorm了。</p><p>但没有Web UI就没有乐趣，没有SSL或身份验证就没有安全感，没有ChatOps就没有乐趣，没有Extreme Workflow Composer就没钱了。继续阅读！</p><h2 id="配置验证"><a href="#配置验证" class="headerlink" title="配置验证"></a>配置验证</h2><p>为简单起见，参考部署使用基于文件的身份验证提供程序。请参阅 <a href="https://docs.stackstorm.com/authentication.html" target="_blank" rel="noopener">身份验证</a>以配置和使用PAM或LDAP身份验证后端。</p><p>要使用基于文件的提供程序设置身份验证：</p><ul><li>使用密码创建用户：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Install htpasswd utility <span class="keyword">if</span> you don<span class="string">'t have it</span></span></span><br><span class="line">sudo yum -y install httpd-tools</span><br><span class="line"><span class="meta">#</span><span class="bash"> Create a user record <span class="keyword">in</span> a password file.</span></span><br><span class="line">echo 'Ch@ngeMe' | sudo htpasswd -i /etc/st2/htpasswd st2admin</span><br></pre></td></tr></table></figure><ul><li>启用并配置身份验证<code>/etc/st2/st2.conf</code>：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[auth]</span><br><span class="line"><span class="meta">#</span><span class="bash"> ...</span></span><br><span class="line">enable = True</span><br><span class="line">backend = flat_file</span><br><span class="line">backend_kwargs = &#123;"file_path": "/etc/st2/htpasswd"&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> ...</span></span><br></pre></td></tr></table></figure><ul><li>重启st2api服务：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo st2ctl restart-component st2api</span><br></pre></td></tr></table></figure><ul><li>验证，并检查它是否有效：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Login - you will be prompted <span class="keyword">for</span> password (default <span class="string">'Ch@ngeMe'</span>)</span></span><br><span class="line">st2 login st2admin</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check that it works</span></span><br><span class="line">st2 action list</span><br></pre></td></tr></table></figure><h2 id="安装WebUI并设置SSL终止"><a href="#安装WebUI并设置SSL终止" class="headerlink" title="安装WebUI并设置SSL终止"></a>安装WebUI并设置SSL终止</h2><p><a href="http://nginx.org/" target="_blank" rel="noopener">NGINX</a>用于提供WebUI静态文件，将HTTP重定向到HTTPS，提供SSL终止，以及反向代理st2auth和st2api API端点。要进行设置：安装 <code>st2web</code>和<code>nginx</code>包，生成证书或放置现有证书<code>/etc/ssl/st2</code>，并使用StackStorm提供的<a href="https://github.com/StackStorm/st2/tree/master/conf/nginx/st2.conf" target="_blank" rel="noopener">站点配置文件st2.conf</a>配置nginx</p><p>StackStorm依赖于Nginx版本&gt; = 1.7.5。RHEL在软件包存储库中有一个旧版本，因此您需要添加官方Nginx存储库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Add key and repo <span class="keyword">for</span> the latest stable nginx</span></span><br><span class="line">sudo rpm --import http://nginx.org/keys/nginx_signing.key</span><br><span class="line">sudo sh -c "cat &lt;&lt;EOT &gt; /etc/yum.repos.d/nginx.repo</span><br><span class="line">[nginx]</span><br><span class="line">name=nginx repo</span><br><span class="line">baseurl=http://nginx.org/packages/rhel/\\\$releasever/x86_64/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">EOT"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Ensure that EPEL repo is not used <span class="keyword">for</span> nginx</span></span><br><span class="line">sudo sed -i 's/^\(enabled=1\)$/exclude=nginx\n\1/g' /etc/yum.repos.d/epel.repo</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Install nginx</span></span><br><span class="line">sudo yum install -y nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Install st2web</span></span><br><span class="line">sudo yum install -y st2web</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Generate a self-signed certificate or place your existing certificate under /etc/ssl/st2</span></span><br><span class="line">sudo mkdir -p /etc/ssl/st2</span><br><span class="line">sudo openssl req -x509 -newkey rsa:2048 -keyout /etc/ssl/st2/st2.key -out /etc/ssl/st2/st2.crt \</span><br><span class="line">-days 365 -nodes -subj "/C=US/ST=California/L=Palo Alto/O=StackStorm/OU=Information \</span><br><span class="line">Technology/CN=$(hostname)"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Copy and <span class="built_in">enable</span> the supplied nginx config file</span></span><br><span class="line">sudo cp /usr/share/doc/st2/conf/nginx/st2.conf /etc/nginx/conf.d/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Disable default_server configuration <span class="keyword">in</span> existing /etc/nginx/nginx.conf</span></span><br><span class="line">sudo sed -i 's/default_server//g' /etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line">sudo systemctl restart nginx</span><br><span class="line">sudo systemctl enable nginx</span><br></pre></td></tr></table></figure><p>如果修改nginx配置中的ports或url路径，请在st2web配置中进行相应的更改<code>/opt/stackstorm/static/webui/config.js</code></p><p>使用浏览器连接<code>https://${ST2_HOSTNAME}</code>并登录WebUI</p><p>如果您无法连接到Web浏览器，则可能需要更改默认防火墙设置。您可以使用以下命令执行此操作：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-service=http --add-service=https</span><br><span class="line">firewall-cmd --zone=public --permanent --add-service=http --add-service=https</span><br></pre></td></tr></table></figure><p>这将允许入站HTTP（端口80）和HTTPS（端口443）流量，并使这些更改在重新启动后继续存在。</p><p>如果您尝试从框外访问API并且已根据这些说明配置了nginx，请使用<code>https://${EXTERNAL_IP}/api/v1/${REST_ENDPOINT}</code>。</p><p>例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET -H  'Connection: keep-alive' -H  'User-Agent: manual/curl' -H  'Accept-Encoding: gzip, deflate' -H  'Accept: */*' -H  'X-Auth-Token: &lt;YOUR_TOKEN&gt;' https://1.2.3.4/api/v1/actions</span><br></pre></td></tr></table></figure><p>同样，您可以使用连接到auth REST端点<code>https://${EXTERNAL_IP}/auth/v1/${AUTH_ENDPOINT}</code>。</p><p>您可以通过向<code>--debug</code>CLI命令添加适当资源的选项来查看资源的实际REST端点。</p><p>例如，要查看获取操作的端点，请调用：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">st2 --debug action list</span><br></pre></td></tr></table></figure><h2 id="设置ChatOps"><a href="#设置ChatOps" class="headerlink" title="设置ChatOps"></a>设置ChatOps</h2><p>如果您已经运行了Hubot实例，则可以安装<a href="https://github.com/StackStorm/hubot-stackstorm" target="_blank" rel="noopener">hubot-stackstorm插件</a>并配置StackStorm环境变量，如下所述。否则，启用<a href="https://docs.stackstorm.com/chatops/index.html" target="_blank" rel="noopener">StackStorm ChatOps</a>的最简单方法 是使用<a href="https://github.com/stackstorm/st2chatops/" target="_blank" rel="noopener">st2chatops</a>包。</p><ul><li>验证<code>chatops</code>是否已安装该包，并启用了通知规则：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Ensure chatops pack is <span class="keyword">in</span> place</span></span><br><span class="line">ls /opt/stackstorm/packs/chatops</span><br><span class="line"><span class="meta">#</span><span class="bash"> Create notification rule <span class="keyword">if</span> not yet enabled</span></span><br><span class="line">st2 rule get chatops.notify || st2 rule create /opt/stackstorm/packs/chatops/rules/notify_hubot.yaml</span><br></pre></td></tr></table></figure><ul><li>添加<a href="https://nodejs.org/en/download/package-manager/" target="_blank" rel="noopener">NodeJS v10存储库</a>：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sL https://rpm.nodesource.com/setup_10.x | sudo -E bash -</span><br></pre></td></tr></table></figure><ul><li>安装<code>st2chatops</code>包：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y st2chatops</span><br></pre></td></tr></table></figure><ul><li><p>查看并编辑<code>/opt/stackstorm/chatops/st2chatops.env</code>配置文件，将其指向StackStorm安装和您正在使用的聊天服务。您至少应该生成 <a href="https://docs.stackstorm.com/authentication.html#authentication-apikeys" target="_blank" rel="noopener">API密钥</a>并设置<code>ST2_API_KEY</code>变量。默认情况下<code>st2api</code>，<code>st2auth</code>预计它们位于同一主机上。如果不是这种情况，请更新<code>ST2_API</code>和<code>ST2_AUTH_URL</code>变量或只是指向正确的主机 <code>ST2_HOSTNAME</code>。</p><p>示例配置使用Slack。要进行此设置，请转到Slack Web管理界面，创建一个Bot，然后将身份验证令牌复制到<code>HUBOT_SLACK_TOKEN</code>。</p><p>如果您使用的是其他聊天服务，请在以下部分中设置相应的环境变量 ： <a href="https://github.com/slackhq/hubot-slack" target="_blank" rel="noopener">Slack</a>， <a href="https://github.com/hipchat/hubot-hipchat" target="_blank" rel="noopener">HipChat</a>，<a href="https://github.com/flowdock/hubot-flowdock" target="_blank" rel="noopener">Flowdock</a>， <a href="https://github.com/nandub/hubot-irc" target="_blank" rel="noopener">IRC</a>， <a href="https://github.com/loafoe/hubot-matteruser" target="_blank" rel="noopener">Mattermost</a>， <a href="https://github.com/RocketChat/hubot-rocketchat" target="_blank" rel="noopener">RocketChat</a>，<a href="https://github.com/markstory/hubot-xmpp" target="_blank" rel="noopener">XMPP</a>。<code>Chat service adapter settings``st2chatops.env</code></p></li><li><p>启动服务：</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start st2chatops</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Start st2chatops on boot</span></span><br><span class="line">sudo systemctl enable st2chatops</span><br></pre></td></tr></table></figure><ul><li>重新加载st2包以确保<code>chatops.notify</code>注册规则：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo st2ctl reload --register-all</span><br></pre></td></tr></table></figure><p>开始聊天吧！！！</p><h2 id="安全注意事项"><a href="#安全注意事项" class="headerlink" title="安全注意事项"></a>安全注意事项</h2><p>默认情况下，安装MongoDB，RabbitMQ和PostgreSQL时，它们会禁用身份验证或使用默认静态密码。因此，在安装这些服务之后，您应该配置它们并使用强大的随机生成的密码启用身份验证。</p><p><strong>注意：</strong>如果您使用StackStorm安装脚本，则会自动完成此操作。</p><p>为这些服务配置授权和密码超出了本文档的范围。有关更多信息，请参阅以下链接</p><ul><li>MongoDB的- <a href="https://docs.mongodb.com/manual/tutorial/enable-authentication/，https://docs.mongodb.com/manual/core/authorization/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/tutorial/enable-authentication/，https://docs.mongodb.com/manual/core/authorization/</a></li><li>RabbitMQ - <a href="https://www.rabbitmq.com/authentication.html" target="_blank" rel="noopener">https://www.rabbitmq.com/authentication.html</a></li><li>PostgreSQL - <a href="https://www.postgresql.org/docs/9.4/static/auth-methods.html" target="_blank" rel="noopener">https://www.postgresql.org/docs/9.4/static/auth-methods.html</a></li></ul><p>为这些组件启用身份验证后，还需要更新StackStorm服务以使用新设置。</p><p>这意味着编辑以下配置选项：</p><ol><li>StackStorm - <code>/etc/st2/st2.conf</code></li></ol><blockquote><ul><li><p><code>database.username</code> - MongoDB数据库用户名。</p></li><li><p><code>database.password</code> - MongoDB数据库密码。</p></li><li><p><code>messaging.url</code>- RabbitMQ传输网址（<code>amqp://&lt;username&gt;:&lt;password&gt;@&lt;hostname&gt;:5672</code>）</p></li></ul></blockquote><p>2，mistral - <code>/etc/mistral/mistral.conf</code></p><blockquote><ul><li><code>database.connection</code>- PostgreSQL数据库连接字符串（<code>postgresql+psycopg2://&lt;username&gt;:&lt;password&gt;@&lt;hostname&gt;/mistral</code>）</li><li><code>transport_url</code>- RabbitMQ传输网址（<code>rabbit://&lt;username&gt;:&lt;password&gt;@&lt;hostname&gt;:5672</code>）</li></ul></blockquote><p>此外，强烈建议您遵循以下最佳实践来运行网络服务：</p><ul><li>确保服务之间的通信已加密。为MongoDB，RabbitMQ和PostgreSQL启用SSL / TLS。</li><li>将服务配置为仅侦听localhost，并在需要时侦听内部IP地址。通常不需要StackStorm（MongoDB，RabbitMQ，PostgreSQL）使用的大多数服务在公共IP地址上可用。</li><li>配置防火墙并设置白名单。防火墙应仅允许那些需要访问这些服务的用户和系统进行访问。API和auth服务通常需要您的用户可访问，但其他相关服务（如MongoDB，RabbitMQ和PostgreSQL）则不需要。这些不应该由用户直接访问，并且只允许StackStorm组件与它们通信。</li><li>在可能的情况下，您还应该使用其他基于网络的隔离和安全功能，例如DMZ。</li></ul><p>上述步骤对于StackStorm组件在多个服务器上运行的分布式生产部署尤为重要。</p><h2 id="升级到Extreme-Workflow-Composer"><a href="#升级到Extreme-Workflow-Composer" class="headerlink" title="升级到Extreme Workflow Composer"></a>升级到Extreme Workflow Composer</h2><p>Extreme Workflow Composer将Workflow Designer（用于创建/编辑工作流的图形工具），RBAC和LDAP添加到StackStorm。它作为一组附加软件包部署在StackStorm之上。您将需要一个有效的Extreme Workflow Composer订阅和一个许可证密钥来访问Extreme Workflow Composer存储库。</p><p>要了解有关Extreme Workflow Composer的更多信息，请求报价或获取评估许可证，请访问<a href="https://stackstorm.com/features/#ewc/" target="_blank" rel="noopener">stackstorm.com/product</a>。</p><p>要安装Extreme Workflow Composer，请<code>${EWC_LICENSE_KEY}</code>在下面的命令中使用您在注册或购买时收到的密钥进行替换，然后运行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Set up Extreme Workflow Composer repository access</span></span><br><span class="line">curl -s https://$&#123;EWC_LICENSE_KEY&#125;:@packagecloud.io/install/repositories/StackStorm/enterprise/script.rpm.sh | sudo bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> Install Extreme Workflow Composer</span></span><br><span class="line">sudo yum install -y bwc-enterprise</span><br><span class="line">sudo st2ctl restart</span><br></pre></td></tr></table></figure></div><script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script><script>var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if(!isMobile){var btw=new BTWPlugin;btw.init({id:"vip-container",blogId:"19128-1593691079092-122",name:"豌豆多多笔记",qrcode:"https://wandouduoduo.gitee.io/about/index/gongzhonghao.jpg",keyword:"vip"})}</script></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script><script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script><p><span>本文标题:</span><a href="/articles/c8f378bd.html">Stackstorm之一键安装</a></p><p><span>文章作者:</span><a href="/" title="访问 WanDouDuoDuo 的个人博客">WanDouDuoDuo</a></p><p><span>发布时间:</span>2019年06月12日 - 17:06</p><p><span>最后更新:</span>2019年10月31日 - 18:10</p><p><span>原始链接:</span><a href="/articles/c8f378bd.html" title="Stackstorm之一键安装">https://wandouduoduo.gitee.io/articles/c8f378bd.html</a><span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://wandouduoduo.gitee.io/articles/c8f378bd.html" aria-label="复制成功！"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p></div><script>var clipboard=new Clipboard(".fa-clipboard");$(".fa-clipboard").click(function(){clipboard.on("success",function(){swal({title:"",text:"复制成功",icon:"success",showConfirmButton:!0})})})</script></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>原创技术分享，您的支持将鼓励我继续创作</div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="/images/wechatpay.png" alt="WanDouDuoDuo 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="/images/alipay.jpg" alt="WanDouDuoDuo 支付宝"><p>支付宝</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Stackstorm/" rel="tag"><i class="fa fa-tag"></i> Stackstorm</a></div><div class="post-widgets"><div class="social_share"><div><div class="bdsharebuttonbox"><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a><a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a><a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a><a href="#" class="bds_more" data-cmd="more"></a><a class="bds_count" data-cmd="count"></a></div><script>window._bd_share_config={common:{bdText:"",bdMini:"2",bdMiniList:!1,bdPic:""},share:{bdSize:"16",bdStyle:"0"},image:{viewList:["tsina","douban","sqq","qzone","weixin","twi","fbook"],viewText:"分享到：",viewSize:"16"}}</script><script>with(document)(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="/static/api/js/share.js?cdnversion="+~(-new Date/36e5)</script></div></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/articles/514c154e.html" rel="next" title="Stackstorm的介绍与入门"><i class="fa fa-chevron-left"></i> Stackstorm的介绍与入门</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/articles/34f69489.html" rel="prev" title="基于Docker的高可用集群xxl-job分布式任务调度">基于Docker的高可用集群xxl-job分布式任务调度<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="gitalk-container"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/me.jpg" alt="WanDouDuoDuo"><p class="site-author-name" itemprop="name">WanDouDuoDuo</p><p class="site-description motion-element" itemprop="description">沪漂资深运维架构师的呕心笔记</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">157</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">42</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">55</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/wandouduoduo" title="GitHub &rarr; https://github.com/wandouduoduo" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:wandouduoduo@163.com" title="E-Mail &rarr; mailto:wandouduoduo@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://gitee.com/wandouduoduo" title="Gitee &rarr; https://gitee.com/wandouduoduo" rel="noopener" target="_blank"><i class="fa fa-fw fa-heartbeat"></i> Gitee</a></span><span class="links-of-author-item"><a href="https://weibo.com/u/1989032071/home?topnav=1&wvr=6" title="微博 &rarr; https://weibo.com/u/1989032071/home?topnav=1&wvr=6" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> 微博</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://www.runoob.com/" title="https://www.runoob.com/" rel="noopener" target="_blank">菜鸟教程</a></li><li class="links-of-blogroll-item"> <a href="https://code.ziqiangxuetang.com/" title="https://code.ziqiangxuetang.com/" rel="noopener" target="_blank">自强学堂</a></li><li class="links-of-blogroll-item"> <a href="http://www.zsythink.net/" title="http://www.zsythink.net/" rel="noopener" target="_blank">朱双印博客</a></li><li class="links-of-blogroll-item"> <a href="http://www.ypk1226.com/" title="http://www.ypk1226.com/" rel="noopener" target="_blank">于佩康博客</a></li><li class="links-of-blogroll-item"> <a href="https://www.dgstack.cn/" title="https://www.dgstack.cn/" rel="noopener" target="_blank">逗哥架构师之路</a></li><li class="links-of-blogroll-item"> <a href="https://pincheng.xyz/" title="https://pincheng.xyz/" rel="noopener" target="_blank">运维饼铛</a></li><li class="links-of-blogroll-item"> <a href="https://me.jinchuang.org/" title="https://me.jinchuang.org/" rel="noopener" target="_blank">靳闯博客</a></li></ul></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#安装"><span class="nav-number">1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考文档"><span class="nav-number">2.</span> <span class="nav-text">参考文档</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#系统要求"><span class="nav-number">3.</span> <span class="nav-text">系统要求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装-1"><span class="nav-number">4.</span> <span class="nav-text">安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#系统环境"><span class="nav-number">4.1.</span> <span class="nav-text">系统环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#调整SELinux策略"><span class="nav-number">4.2.</span> <span class="nav-text">调整SELinux策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装依赖项"><span class="nav-number">4.3.</span> <span class="nav-text">安装依赖项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置存储库"><span class="nav-number">4.4.</span> <span class="nav-text">设置存储库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装StackStorm组件"><span class="nav-number">4.5.</span> <span class="nav-text">安装StackStorm组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置数据存储区加密"><span class="nav-number">4.6.</span> <span class="nav-text">设置数据存储区加密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置Mistral数据库"><span class="nav-number">4.7.</span> <span class="nav-text">设置Mistral数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置SSH和SUDO"><span class="nav-number">4.8.</span> <span class="nav-text">配置SSH和SUDO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#启动服务"><span class="nav-number">4.9.</span> <span class="nav-text">启动服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#校验"><span class="nav-number">4.10.</span> <span class="nav-text">校验</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置验证"><span class="nav-number">5.</span> <span class="nav-text">配置验证</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装WebUI并设置SSL终止"><span class="nav-number">6.</span> <span class="nav-text">安装WebUI并设置SSL终止</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置ChatOps"><span class="nav-number">7.</span> <span class="nav-text">设置ChatOps</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安全注意事项"><span class="nav-number">8.</span> <span class="nav-text">安全注意事项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#升级到Extreme-Workflow-Composer"><span class="nav-number">9.</span> <span class="nav-text">升级到Extreme Workflow Composer</span></a></li></ol></div></div></div><script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script><script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script><div class="widget-wrap"><div id="myCanvasContainer" class="widget tagcloud"><canvas width="250" height="250" id="resCanvas" style=""><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ai/">Ai</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ansible/">Ansible</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apollo/">Apollo</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Centos/">Centos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cloud/">Cloud</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cmdb/">Cmdb</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Confd/">Confd</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Confluence/">Confluence</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dns/">Dns</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elk/">Elk</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Experiences/">Experiences</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flask/">Flask</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GlusterFS/">GlusterFS</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Go/">Go</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Haproxy/">Haproxy</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Http/">Http</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Iptables/">Iptables</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/">Jenkins</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/K8s/">K8s</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kali/">Kali</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Keepalived/">Keepalived</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lvs/">Lvs</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/">MongoDB</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/">Mysql</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Network/">Network</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nexus/">Nexus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Open-falcon/">Open-falcon</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Openldap/">Openldap</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Opensips/">Opensips</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Openvpn/">Openvpn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostgreSQL/">PostgreSQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Prometheus/">Prometheus</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redmine/">Redmine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RocketChat/">RocketChat</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Saturn/">Saturn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sentry/">Sentry</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/">Shell</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Stackstorm/">Stackstorm</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Supervisor/">Supervisor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat/">Tomcat</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Uwsgi/">Uwsgi</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web/">Web</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wiki/">Wiki</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows/">Windows</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xxl-job/">Xxl-job</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zabbix/">Zabbix</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zookeeper/">Zookeeper</a><span class="tag-list-count">1</span></li></ul></canvas></div></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2020</span><span class="with-love" id="animate"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">WanDouDuoDuo</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">857k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">12:59</span></div><div class="theme-info"><div class="powered-by"></div> <span class="post-count">博客全站共353.5k字</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> <span class="post-meta-item-icon"><i class="fa fa-user">访问人数:</i></span><span class="site-uv" title="总访客量"><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye">总阅读量:</i></span><span class="site-pv" title="总访问量"><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div><div><script type="text/javascript">var cnzz_protocol="https:"==document.location.protocol?"https://":"http://";document.write(unescape("%3Cspan id='cnzz_stat_icon_1277740757'%3E%3C/span%3E%3Cscript src='"+cnzz_protocol+"s23.cnzz.com/z_stat.php%3Fid%3D1277740757%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"))</script></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script color="255,255,255" opacity="1" zindex="-1" count="150" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/js/src/utils.js?v=6.7.0"></script><script src="/js/src/motion.js?v=6.7.0"></script><script src="/js/src/affix.js?v=6.7.0"></script><script src="/js/src/schemes/pisces.js?v=6.7.0"></script><script src="/js/src/scrollspy.js?v=6.7.0"></script><script src="/js/src/post-details.js?v=6.7.0"></script><script src="/js/src/bootstrap.js?v=6.7.0"></script><script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script src="//cdn.jsdelivr.net/npm/js-md5@0.7.3/src/md5.min.js"></script><script>var gitalk=new Gitalk({clientID:"ad83725549e82facce82",clientSecret:"b67c2056b52d0447f1d78f413f268a5b853e8a6e",repo:"wandouduoduo.github.io",owner:"wandouduoduo",admin:["wandouduoduo"],id:md5(location.pathname),distractionFreeMode:"true"});gitalk.render("gitalk-container")</script><script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(e,t){var n=$("<div>").addClass("highlight-wrap");$(t).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(e){var t=$(this).parent().find(".code").find(".line").map(function(e,t){return $(t).text()}).toArray().join("\n"),n=document.createElement("textarea"),o=document.createRange(),a=window.getSelection(),i=window.pageYOffset||document.documentElement.scrollTop;n.style.top=i+"px",n.style.position="absolute",n.style.opacity="0",n.value=t,n.textContent=t,n.contentEditable=!0,n.readOnly=!1,document.body.appendChild(n),o.selectNode(n),a.removeAllRanges(),a.addRange(o),n.setSelectionRange(0,t.length),document.execCommand("copy")?$(this).text("复制成功"):$(this).text("复制失败"),n.blur(),$(this).blur()})).on("mouseleave",function(e){var t=$(this).find(".copy-btn");setTimeout(function(){t.text("复制")},300)}).append(t)})</script><canvas class="fireworks" style="position:fixed;left:0;top:0;z-index:1;pointer-events:none"></canvas><script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script><script type="text/javascript" src="/js/src/fireworks.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/shizuku.model.json"},display:{position:"right",width:150,height:300},mobile:{show:!0},log:!1})</script></body></html>